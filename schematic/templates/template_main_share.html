<!--
  _____                    _      _____                    _       _
 |  ___| __ __ _ _ __ ___ (_)_  _|_   _|__ _ __ ___  _ __ | | __ _| |_ ___
 | |_ | '__/ _` | '_ ` _ \| \ \/ / | |/ _ \ '_ ` _ \| '_ \| |/ _` | __/ _ \
 |  _|| | | (_| | | | | | | |>  <  | |  __/ | | | | | |_) | | (_| | ||  __/
 |_|  |_|  \__,_|_| |_| |_|_/_/\_\ |_|\___|_| |_| |_| .__/|_|\__,_|\__\___|
                                                    |_|

Copyright (c) 2024  Framix :: 画帧秀
This file is licensed under the Framix :: 画帧秀 License. See the LICENSE.md file for more details.
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <title>{{ app_desc }} - Main - Share</title>
    <style>
        /* 加载动画 */
        #loading {
            position: fixed;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            z-index: 9999;
        }
        .spinner-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        .spinner {
            border: 20px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 20px solid #deff07;
            width: 200px;
            height: 200px;
            position: absolute;
            animation: spin 1s linear infinite;
        }
        .loading-text {
            font-size: 16px;
            font-weight: bold;
            transform: translate(-50%, -50%);
        }
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* 背景粒子特效 */
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
            background: linear-gradient(to top, #ada996, #f2f2f2, #dbdbdb, #eaeaea);
        }

        /* 定义滚动条的宽度 */
        ::-webkit-scrollbar {
            width: 10px;
        }
        /* 定义滚动条轨道的样式 */
        ::-webkit-scrollbar-track {
            box-shadow: inset 0 0 5px grey;
            border-radius: 10px;
        }
        /* 定义滚动滑块的样式 */
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        /* 当滑块被鼠标悬停或点击时，改变颜色 */
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* 结果标签容器 */
        .result-container {
            display: flex;
            align-items: center;
            margin: 10px;
        }
        /* 结果标签 */
        .effect-on::before, .effect-on::after {
            display: block;
        }
        .effect-off::before, .effect-off::after {
            display: none;
        }
        .time-difference.effect-off {
            border: 1px solid #e2e5e9;
            background-image: linear-gradient(45deg, #8BAAAA 0%, #AE8B9C 100%);
            pointer-events: none;
        }

        /* 结果显示 */
        .time-difference {
            position: relative;
            width: 120px;
            padding: 5px 20px;
            border-radius: 10px;
            border: 1px solid #7dd87d;
            background: linear-gradient(135deg, #c6f6d5 0%, #81e6d9 100%);
            color: #1a202c;
            outline: none;
            overflow: hidden;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .time-difference:hover {
            background: linear-gradient(135deg, #fddb92 0%, #d1fdff 100%);
            color: #2a2a2a;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
        }

        .time-difference:active {
            transform: scale(0.95);
        }
        .time-difference:hover::before, .time-difference:hover::after {
            background-color: #2a2626;  /* 增加对比 */
            transition: background-color 0.3s; /* 平滑过渡效果 */
        }

        .time-difference::before, .time-difference::after {
            content: "";
            position: absolute;
            width: 10%;
            height: 2px;
            background-color: #fff;  /* 这是线条的颜色 */
            transition: all 0.5s;
        }
        .time-difference::before {
            top: 0;
            left: 0;
            transform: translateY(-100%);
            animation: topLine 1s infinite;
        }
        .time-difference::after {
            bottom: 0;
            right: 0;
            transform: translateY(100%);
            animation: bottomLine 1s infinite;
        }
        @keyframes topLine {
            0%, 100% {
                left: 0;
                top: 0;
                transform: translateY(-100%);
            }
            25% {
                left: 100%;
                top: 0;
                transform: translateX(100%);
            }
            50% {
                left: 100%;
                top: 100%;
                transform: translateY(100%);
            }
            75% {
                left: 0;
                top: 100%;
                transform: translateX(-100%);
            }
        }
        @keyframes bottomLine {
            0%, 100% {
                right: 0;
                bottom: 0;
                transform: translateY(100%);
            }
            25% {
                right: 100%;
                bottom: 0;
                transform: translateX(-100%);
            }
            50% {
                right: 100%;
                bottom: 100%;
                transform: translateY(-100%);
            }
            75% {
                right: 0;
                bottom: 100%;
                transform: translateX(100%);
            }
        }

        /* 标题容器 */
        .h1-container {
            display: flex;
            justify-content: center;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(130, 130, 130, 0.3);
        }
        /* 标题 */
        h1 {
            font-size: 48px;
            font-weight: 800;
            padding: 14px 28px;
            margin: 20px;
            letter-spacing: 2px;
            color: transparent;
            background-image: linear-gradient(135deg, #8e44ad, #3498db);
            -webkit-background-clip: text;
            border: 2px solid rgba(0, 201, 255, 0.3);
            border-radius: 16px;
            box-shadow: 0 0 12px rgba(0, 201, 255, 0.3);
            transition: all 0.4s ease;
        }
        h1::before {
            content: "";
            position: absolute;
            top: 0;
            left: -75%;
            width: 50%;
            height: 100%;
            background: rgba(255, 255, 255, 0.08);
            transform: skewX(-20deg);
            transition: left 0.6s ease;
            z-index: 0;
        }
        h1:hover::before {
            left: 130%;
        }
        h1:hover {
            border-color: rgba(0, 201, 255, 0.6);
            box-shadow: 0 0 18px rgba(0, 201, 255, 0.5);
            cursor: grab;
        }

        /* 主容器 */
        .container {
            position: relative;
            max-width: 90%;
            background-color: hsla(0, 100%, 100%, 0);
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px; /* 内边距 */
            overflow: hidden; /* 隐藏溢出的内容，以保持圆角效果 */
        }

        /* 一组主图的容器 */
        .image-container {
            display: flex;
            max-height: 60vh;
            overflow-x: auto;
            margin: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        /* 主图容器 */
        .image-box {
            width: 100%;
            height: 100%;
            border-radius: 10px;
            margin: 20px 10px;
            text-align: center;
        }
        .image-box:hover {
            transform: scale(1.01);
            box-shadow: 0px 0px 10px 2px rgb(233 177 10 / 90%);
            transition: transform 0.3s ease, box-shadow 0.5s ease;
        }

        /* 主图 */
        .image-box img {
            width: 90%;
            height: 90%;
            object-fit: contain;
            margin: 10px auto;
            border-radius: 10px;
        }
        .image-box img:hover {
            cursor: zoom-in;
            transform: scale(1.01);
            transition: transform 0.3s ease;
        }
        .image-box img:active {
            transform: scale(0.95);
        }
        .info {
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            margin: 5px;
            color: #eb4d4b;
        }

        /* 图片已选择 */
        .selected {
            transform: scale(1.01);
            box-shadow: 0px 0px 10px 2px rgb(228 63 36 / 90%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .selected:hover {
            transform: scale(1.02);
            box-shadow: 0px 0px 10px 2px rgb(200 36 228 / 90%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        /* 标记标签 */
        .mark-button {
            border: none;
            font-size: 12px;
            padding: 1px 20%;
            cursor: pointer;
            background-color: #2481e4;
            color: white;
            border-radius: 10px;
            transition: background-color 0.3s ease;
        }
        .mark-button:hover {
            padding: 1px 18%;
            background-color: #e9b10a;
            transition: padding 0.5s ease, background-color 0.5s ease;
        }
        .mark-button:active {
            transform: scale(0.95);
        }
        .marked {
            background-color: #e43f24;
            transition: background-color 0.3s ease;
        }

        /* 选项标签 */
        .options {
            display: flex;
            gap: 30px;
            justify-content: center;
            align-items: center;
            margin: 30px;
            white-space: nowrap;
        }
        .option-one, .option-two {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .option-copy-div {
            display: flex;
        }
        /* 通用按钮与链接样式 */
        .all-copy, .all-reselect, .quick-reselect, .ex-info, .linked {
            margin: 6px;
            padding: 5px 30px;
            border: none;
            border-radius: 14px;
            font-weight: bold;
            font-size: 15px;
            color: white;
            text-align: center;
            text-decoration: none;
            letter-spacing: 0.5px;
            background-size: 200% 200%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-position 0.4s;
        }     
        /* ===== ALL COPY 专属 ===== */
        .all-copy {
            background: linear-gradient(135deg, rgba(255, 117, 140, 0.75), rgba(255, 126, 179, 0.75));
            color: #ffffff;
            border: 1px solid rgba(255, 200, 210, 0.5);
            box-shadow: 0 4px 14px rgba(255, 117, 140, 0.25);
        }
        /* ===== ALL COPY 悬浮效果 ===== */
        .all-copy:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, rgba(255, 117, 140, 0.85), rgba(255, 126, 179, 0.85));
            box-shadow: 0 8px 24px rgba(255, 117, 140, 0.5);
            border-color: rgba(255, 160, 175, 0.9);
            filter: brightness(1.05);
        }
        /* 主功能按钮：绿蓝渐变 */
        .all-reselect, .quick-reselect {
            background-image: linear-gradient(135deg, #00c9ff, #92fe9d);
        }
        /* 次要信息按钮 & 链接：蓝紫渐变 */
        .ex-info, .linked {
            background-image: linear-gradient(135deg, #667eea, #764ba2);
        }
        /* 悬停高光动画 */
        .all-reselect:hover, .quick-reselect:hover, .ex-info:hover, .linked:hover {
            transform: scale(1.05);
            background-position: right center;
            box-shadow: 0 6px 20px rgba(0, 201, 255, 0.4);
            color: #ffffff;
        }
        /* 点击反馈 */
        .all-copy:active, .all-reselect:active, .quick-reselect:active, .ex-info:active, .linked:active {
            transform: scale(0.95);
        }
        /* 链接专属调整 */
        .linked:visited {
            color: #e0e0e0;
        }

        /* 灯箱查看器 */
        #lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: opacity 0.3s, transform 0.3s;
        }
        #lightbox.show {
            display: flex;
            opacity: 1;
            transform: scale(1);
        }

        /* 灯箱 - 覆盖层 */
        .content {
            position: relative;
            width: 95%;
            height: 95%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: transparent;
            box-shadow: 0px 0px 10px 6px rgb(231 186 13 / 90%);
            padding: 20px;
        }

        /* 灯箱 - 重选和关闭 */
        #close, #reselect {
            padding: 5px 15px;
            margin: 5px;
            border: none;
            border-radius: 30px;
            background: linear-gradient(135deg, #ff6a00, #fddb6f);
            color: #ffffff;
            font-weight: bold;
            letter-spacing: 0.5px;
            box-shadow: 0 3px 10px rgba(255, 107, 0, 0.4);
            transition: all 0.3s ease;
            overflow: hidden;
        }
        #close::before, #reselect::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 60%);
            opacity: 0;
            transform: scale(0);
            transition: all 0.4s ease;
        }
        #close:hover::before, #reselect:hover::before {
            opacity: 1;
            transform: scale(1);
        }
        #close:hover, #reselect:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 107, 0, 0.6);
            background: linear-gradient(135deg, #ff4e00, #ffc107);
            color: #ffffff;
        }
        #close:active, #reselect:active {
            transform: scale(0.95);
        }
        #close:disabled, #reselect:disabled {
            background: #cccccc;
            color: #666666;
            box-shadow: none;
            cursor: not-allowed;
        }

        /* 灯箱 - 左右导航 */
        .nav-button {
            margin: 5px;
            padding: 50px 20px;
            font-size: 16px;
            font-weight: bold;
            color: #ffffff;
            background: linear-gradient(180deg, #00c9ff, #92fe9d);
            border: none;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0, 201, 255, 0.3);
            transition: transform 0.2s ease, box-shadow 0.3s ease;
            overflow: hidden;
        }
        .nav-button::before {
            content: "";
            position: absolute;
            top: -60%;
            left: 0;
            width: 100%;
            height: 40%;
            background: rgba(255, 255, 255, 0.3);
            transform: skewY(-20deg);
            transition: top 0.5s ease;
            pointer-events: none;
        }
        .nav-button:hover::before {
            top: 120%;
        }
        .nav-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 24px rgba(0, 201, 255, 0.5);
        }
        .nav-button:active {
            transform: scale(0.95);
        }
        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: linear-gradient(180deg, #aaa, #ccc);
            box-shadow: none;
        }

        /* 灯箱 - 顶部信息 */
        #info-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            height: 10%;
            padding: 6px 0;
            text-align: center;
        }
        .img-info, .lightbox-logo {
            padding: 6px 16px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            user-select: none;
        }
        /* 帧ID / 时间戳样式 */
        .img-info {
            min-width: 150px;
            color: #ffffff;
            background: linear-gradient(135deg, #ff9966, #ff5e62);
            box-shadow: 0 3px 10px rgba(255, 94, 98, 0.3);
        }
        .img-info:hover {
            cursor: grab;
            background: linear-gradient(135deg, #ff5e62, #ffc371);
            box-shadow: 0 5px 12px rgba(255, 130, 80, 0.5);
        }
        .img-info:active {
            transform: scale(0.95);
        }
        /* LOGO 样式 */
        .lightbox-logo {
            min-width: 80px;
            color: #ffffff;
            background: linear-gradient(135deg, #36d1dc, #5b86e5);
            box-shadow: 0 3px 10px rgba(91, 134, 229, 0.3);
        }
        .lightbox-logo:hover {
            cursor: grab;
            background: linear-gradient(135deg, #5b86e5, #7f53ac);
            box-shadow: 0 5px 12px rgba(127, 83, 172, 0.5);
        }
        .lightbox-logo:active {
            transform: scale(0.95);
        }
        /* 内部文字布局 */
        .img-info > p, .lightbox-logo > p {
            margin: 0;
            line-height: 1.4;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
        }

        /* 灯箱 - 主图 */
        #lightbox-img {
            max-width: 80%;
            height: 60%;
            margin: 10px;
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0px 0px 10px 6px rgb(242 242 11 / 45%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        #lightbox-img:hover {
            transform: scale(1.02);
            box-shadow: 0px 0px 10px 6px rgb(242 242 11 / 90%);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        #lightbox-img:active {
            transform: scale(1);
        }
        #lightbox-img.box-selected {
            box-shadow: 0px 0px 10px 6px rgb(242 98 11 / 90%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        #thumbnails {
            display: flex;
            width: 100%;
            height: 30%;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            transition: all 0.3s ease;
        }
        .thumbnail {
            max-width: 30%;
            margin: 20px 10px;
            border-radius: 10px;
            cursor: pointer;
        }
        .thumbnail:hover {
            transform: scale(0.97);
            transition: transform 0.3s ease;
        }
        .thumbnail.active {
            transform: scale(0.97);
            box-shadow: 0px 0px 5px 3px rgb(242 242 11 / 90%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .thumb-selected {
            transform: scale(0.97);
            box-shadow: 0px 0px 5px 3px rgb(242 98 11 / 90%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .thumbnail.thumb-selected.active {
            transform: scale(0.97);
            box-shadow: 0px 0px 5px 3px rgb(17 184 241 / 90%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .thumbnail.active:hover, .thumb-selected:hover, .thumbnail.thumb-selected.active:hover {
            transform: scale(0.95);
            opacity: 0.5;
        }

        /* 警告提示框 */
        .alert {
            display: none;
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .alert-btn {
            padding: 1px 8px;
            border-radius: 10px;
            background-color: #a3e20d;
        }
        .alert-btn:hover {
            background-color: #e2dc0d;
            transition: background-color 0.3s ease;
        }
        .alert-btn:active {
            transform: scale(0.95);
        }
        .alert-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            border-radius: 10px;
            background-color: #fff;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.2);
        }
        .alert-message {
            margin-right: 10px;
        }

        /* 🔹 通知框基础样式 */
        #notification {
            display: none; /* 默认隐藏 */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* 完全居中 */
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #28a745, #218838); /* 绿色渐变背景 */
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        /* 🔹 复制失败时的红色样式 */
        #notification.error {
            background: linear-gradient(135deg, #dc3545, #c82333); /* 红色渐变背景 */
        }
        /* 🔹 显示通知时的动画 */
        #notification.show {
            display: block;
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.1); /* 居中并放大一点 */
        }

        /* 灯箱 - 计算结果提示 */
        .box-res {
            display: inline-block;
            min-width: 100px;
            white-space: nowrap;
            margin: 5px;
            padding: 5px 15px;
            font-weight: bold;
            font-size: 14px;
            color: #ffffff;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            box-shadow: 0 3px 10px rgba(56, 249, 215, 0.3);
            backdrop-filter: blur(4px);
            transition: all 0.3s ease;
            user-select: none;
        }
        .box-res:last-child {
            cursor: copy;
            background: linear-gradient(135deg, #f7971e, #ffd200);
            box-shadow: 0 3px 12px rgba(255, 210, 0, 0.4);
        }
        .box-res:last-child:hover {
            background: linear-gradient(135deg, #f7971e, #64f38c);
            transform: scale(1.05);
            box-shadow: 0 5px 14px rgba(100, 243, 140, 0.6);
        }
        .box-res:last-child:active {
            transform: scale(0.95);
            box-shadow: 0 2px 6px rgba(100, 243, 140, 0.4);
        }
        .box-res p {
            margin: 0;
            padding: 0;
            color: #222222;
            font-size: 13px;
            text-align: center;
            line-height: 1.4;
            letter-spacing: 0.3px;
        }

        /* 灯箱 - 缩略图容器 */
        .thumbnail-box {
            display: contents;
        }
        .thumbnail-box:hover {
            visibility: visible;
        }

        /* 灯箱 - 缩略图悬浮提示 */
        #tooltip {
            display: none;
            position: absolute;
            padding: 1px 5px;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            color: #ffffff;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(0,212,255,0.1));
            border: none;
            border-radius: 12px;
            backdrop-filter: blur(6px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.25);
            transition: transform 0.2s ease, opacity 0.3s ease;
            transform: scale(0.95);
            opacity: 0;
        }
        #tooltip.tips {
            display: block;
            opacity: 1;
            transform: scale(1);
        }

        /* 横屏模式 */
        @media screen and (orientation: landscape) {
            .image-box {
                flex: 0 0 calc(12.5% - 20px);
            }
        }
        /* 竖屏模式 */
        @media screen and (orientation: portrait) {
            .image-box {
                flex: 0 0 calc(25% - 20px);
            }
        }
    </style>
</head>
<body>
    <!--加载动画-->
    <div id="loading">
        <div class="spinner-container">
            <div class="spinner"></div>
            <div class="loading-text">Loading...</div>
        </div>
    </div>

    <!--背景动画-->
    <canvas id="canvas"></canvas>

    <!--图片选择-->
    <div class="container">
        <div class="h1-container">
            <h1 class="text-center">{{ title }}</h1>
        </div>
        {% for res in images_list %}
        <div class="image-container" data-query="{{ res.query }}" data-start="{{ res.stage.start }}" data-end="{{ res.stage.end }}">
            {% for image in res.image_list %}
            <div class="image-box {{ 'selected' if (image.frame_id| int) == res.stage.start or (image.frame_id| int) == res.stage.end else '' }}">
                <img src="{{ image.src }}" class="img-fluid" alt="Image" data-frame="{{ image.frame_id }}" data-timestamp="{{ image.timestamp }}">
                <div class="mark-button-div">
                    <button class="mark-button {{ 'marked' if (image.frame_id| int) == res.stage.start or (image.frame_id| int) == res.stage.end else '' }}">标记</button>
                </div>
                <div class="info" data-id="{{ image.frame_id }}" data-ts="{{ image.timestamp }}">
                    <span>{{ image.frame_id }} - {{ image.timestamp }}</span>
                </div>
            </div>
            {% endfor %}

            <!--结果-->
            <div class="result-container">
                <button id="timeDifference{{ loop.index }}" class="time-difference">{{ res.stage.cost }}</button>
            </div>

            <!--选项-->
            <div class="options">
                <div class="option-one">
                    <div class="option-copy-div">
                        <button class="all-copy" data-mode="horizontal">↔</button>
                        <button class="all-copy" data-mode="vertical">↕</button>
                    </div>
                    <button class="all-reselect">全部重选</button>
                    <button class="quick-reselect">快速重选</button>
                </div>
                {% if res.get('extra') or res.get('proto') %}
                <div class="option-two">
                    {% if res.get('extra') %}
                    <a href="{{ res.extra }}" target="_blank" class="linked">额外帧</a>
                    {% endif %}

                    {% if res.get('proto') %}
                    <a href="{{ res.proto }}" target="_blank" class="linked">阶段帧</a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- 灯箱查看器 -->
    <div id="lightbox">
        <div class="content">
            <button id="prev" class="nav-button" style="position: absolute; left: 0;"><</button>
            <div id="info-wrapper">
                <div class="img-info">
                    <p>ID: <span id="frame-id"></span></p>
                </div>
                <div class="lightbox-logo">
                    <p><span id="box-logo">{{ app_desc }}</span></p>
                </div>
                <div class="img-info">
                    <p>TS: <span id="timestamp"></span></p>
                </div>
            </div>
            <img id="lightbox-img" src="" alt="Image" data-frame="" data-timestamp="">
            <div id="thumbnails"></div>
            <button id="next"  class="nav-button" style="position: absolute; right: 0;">></button>
            <button id="close" style="position: absolute; top: 0; right: 0;">X</button>
            <button id="reselect" style="position: absolute; top: 0; left: 0;">R</button>
            <div class="box-res" style="position: absolute; top: 18%; left: 0;">
                <p id="box-diff1">0 -> 0</p>
            </div>
            <div class="box-res" style="position: absolute; top: 25%; left: 0;">
                <p id="box-diff2">0.00000</p>
            </div>
        </div>
    </div>

    <!-- 警告提示框 -->
    <div id="custom-alert" class="alert">
        <div class="alert-content">
            <span class="alert-message"></span>
            <button class="alert-btn" onclick="closeAlert()">确定</button>
        </div>
    </div>

    <!-- 缩略图悬浮提示 -->
    <div id="tooltip"></div>

    <!-- 通知消息 -->
    <div id="notification"></div>

    <!-- toast提示 -->
    <div id="toast" class="toast"></div>

    <!-- 主图选择器 -->
    <script>
        var containers = document.querySelectorAll('.image-container');
        containers.forEach((container, idx) => {
            container.querySelectorAll('.mark-button').forEach(markButton => {
                markButton.addEventListener('click', function(e) {
                    var target = e.target;
                    var parent = target.closest('.image-box');;
                    var frameId = Number(parent.querySelector('img').getAttribute('data-frame'));
                    var frame = Number(parent.querySelector('img').getAttribute('data-timestamp'));

                    if (target.classList.contains('marked')) {
                        target.classList.remove('marked');
                        parent.classList.remove('selected');
                    } else {
                        var markedInContainer = container.querySelectorAll('.marked');
                        if (markedInContainer.length < 2) {
                            target.classList.add('marked');
                            parent.classList.add('selected');
                        } else {
                            showAlert('已经选择了两个标记，请先取消一个标记再进行操作！');
                            return;
                        }
                    }

                    // 获取所有的结果标签
                    let resContainers = Array.from(document.querySelectorAll('.result-container'));
                    let timeDivs = Array.from(document.querySelectorAll('.time-difference'));
                    // 重新获取选中的元素
                    selectedInContainer = container.querySelectorAll('.selected');
                    let allImages = Array.from(containers[idx].querySelectorAll('.image-box img'));
                    let options = Array.from(document.querySelectorAll('.options'));

                    // 如果有两个选中的元素，获取它们的帧数据并计算差值
                    if (selectedInContainer.length === 2) {
                        timeDivs[idx].classList.add('effect-on');
                        timeDivs[idx].classList.remove('effect-off');
                        options[idx].style.display = 'flex';
                        allImages.forEach(image => {
                            if (!image.parentElement.classList.contains('selected')) {
                                image.parentElement.style.display = 'none';
                            }
                        });

                        var timestamp1 = Number(selectedInContainer[0].querySelector('img').getAttribute('data-timestamp'));
                        var timestamp2 = Number(selectedInContainer[1].querySelector('img').getAttribute('data-timestamp'));
                        timeDivs[idx].textContent = Math.abs(timestamp2 - timestamp1).toFixed(5);
                        resContainers[idx].style.display = 'flex';
                    } else {
                        // 如果选中的标记少于两个，清空结果显示
                        timeDivs[idx].textContent = '0.00000';
                        timeDivs[idx].classList.remove('effect-on');
                        timeDivs[idx].classList.add('effect-off');
                        resContainers[idx].style.display = 'none';
                        options[idx].style.display = 'none';
                        // 显示该容器的所有图片
                        allImages.forEach(image => {
                            if (image.parentElement.style.display === 'none') {
                                image.parentElement.style.display = '';
                            }
                        });
                    }
                });
            });
        });

        // 快速重选
        var quickButtons = document.querySelectorAll('.quick-reselect');
        quickButtons.forEach((quick, idx) => {
            quick.addEventListener('click', function(e) {
                let resContainers = Array.from(document.querySelectorAll('.result-container'));
                let timeDivs = Array.from(document.querySelectorAll('.time-difference'));
                let options = Array.from(document.querySelectorAll('.options'));
                resContainers[idx].style.display = 'none';
                timeDivs[idx].textContent = '0.00000';
                timeDivs[idx].classList.remove('effect-on');
                timeDivs[idx].classList.add('effect-off');
                options[idx].style.display = 'none';
                boxSideBar('0 -> 0', 'none', '0.00000', 'none');

                let quickParent = e.currentTarget.closest('.image-container');
                marked = quickParent.querySelectorAll('.marked');
                marked.forEach(mark => {mark.classList.remove('marked')});
                selected = quickParent.querySelectorAll('.selected');
                selected.forEach(select => {select.classList.remove('selected')});

                boxImage = quickParent.querySelectorAll('.image-box');
                boxImage.forEach(box => {box.style.display = ''});
                images = Array.from(quickParent.querySelectorAll('.image-box img'));
                diffIndex = idx;  // 获取当前容器的索引
                currentImageIndex = 0;  // 获取当前图片的索引
                let firstImage = images[currentImageIndex];

                openLightbox();
                lightboxImg.src = firstImage.src;
                lightboxImg.dataset.frame = firstImage.dataset.frame;
                lightboxImg.dataset.timestamp = firstImage.dataset.timestamp;
                frameIdSpan.textContent = firstImage.dataset.frame;
                timestampSpan.textContent = firstImage.dataset.timestamp;

                originalImage = firstImage;  // 获取原始图片的信息
                updateButtonStatus();  // 更新前后按钮的状态
                boxVision();  // 更新主图显示状态
                updateThumbnails();  // 更新缩略图
                scrollToActive(); // 滚动条自动跟随
            });
        });

        // 设置灯箱结果
        function boxSideBar(diff1, vision1, diff2, vision2) {
            let boxDiff1 = document.querySelector('#box-diff1');
            let boxDiff2 = document.querySelector('#box-diff2');
            boxDiff1.textContent = diff1;
            boxDiff1.parentElement.style.display = vision1;
            boxDiff2.textContent = diff2;
            boxDiff2.parentElement.style.display = vision2;
        }

        // 灯箱结果标签的点击事件
        var boxResult = document.querySelectorAll('.box-res:last-child');
        boxResult.forEach((res, idx) => {
            res.addEventListener('click', function(e) {
                resp = res.querySelector('p');
                let rawContent = resp.textContent;
                // 尝试将内容转换为数字并保留小数点后五位
                let numberContent = parseFloat(rawContent);
                if (!isNaN(numberContent)) {
                    rawContent = numberContent.toFixed(5);
                }
                // 去除换行、空白等格式
                let cleanContent = rawContent.trim().replace(/\s+/g, ' ');
                copyAction(cleanContent);
            });
        });
    </script>

    <!--灯箱查看器-->
    <script>
        var lightbox = document.getElementById('lightbox');
        var lightboxImg = document.getElementById('lightbox-img');
        var frameIdSpan = document.getElementById('frame-id');
        var timestampSpan = document.getElementById('timestamp');
        var prevButton = document.getElementById('prev');
        var nextButton = document.getElementById('next');
        var closeButton = document.getElementById('close');
        var reselectButton = document.getElementById('reselect');
        var tools = document.getElementById('tooltip');

        var imageContainers = Array.from(document.querySelectorAll('.image-container'));
        var images = [];
        var currentImageIndex = 0;
        var originalImage;
        var diffIndex;

        // 打开灯箱
        function openLightbox() {
            lightbox.classList.add('show');
            window.addEventListener('keydown', keyListener); // 启用键盘监听
        }

        // 关闭灯箱
        function closeLightbox() {
            lightbox.classList.remove('show');
            window.removeEventListener('keydown', keyListener); // 停止键盘监听
        }

        // 监听每个容器的图片点击事件
        imageContainers.forEach((imageContainer, containerIndex) => {
            var currentImages = Array.from(imageContainer.querySelectorAll('.image-box img'));
            currentImages.forEach((image, index) => {
                image.addEventListener('click', function(e) {
                    openLightbox();
                    lightboxImg.src = e.target.src;
                    lightboxImg.dataset.frame = e.target.dataset.frame;
                    lightboxImg.dataset.timestamp = e.target.dataset.timestamp;
                    frameIdSpan.textContent = e.target.dataset.frame;
                    timestampSpan.textContent = e.target.dataset.timestamp;
                    diffIndex = containerIndex;  // 获取当前容器的索引
                    currentImageIndex = index;  // 获取当前图片的索引

                    let selectedImage = Array.from(imageContainer.querySelectorAll('.selected'));
                    if (selectedImage.length === 0) {
                        // 显示缩略图
                        images = currentImages;
                        boxSideBar('0 -> 0', 'none', '0.00000', 'none');

                    } else if (selectedImage.length === 1) {
                        // 显示缩略图
                        images = currentImages;
                        currentImageIndex = images.indexOf(e.target);
                        let diff1 = selectedImage[0].querySelector('img');
                        boxSideBar(diff1.dataset.frame, '', '0.00000', 'none');

                    } else if (selectedImage.length === 2) {
                        // 隐藏缩略图
                        images = currentImages.filter(img => img.parentElement.style.display === '');
                        currentImageIndex = images.indexOf(e.target);
                        let frame1 = Number(selectedImage[0].querySelector('img').getAttribute('data-frame'));
                        let frame2 = Number(selectedImage[1].querySelector('img').getAttribute('data-frame'));
                        let timestamp1 = Number(selectedImage[0].querySelector('img').getAttribute('data-timestamp'));
                        let timestamp2 = Number(selectedImage[1].querySelector('img').getAttribute('data-timestamp'));
                        let diff = Math.abs(timestamp2 - timestamp1).toFixed(5);
                        boxSideBar(frame1 + ' -> ' + frame2, '', diff, '');
                    }

                    originalImage = e.target;  // 获取原始图片的信息
                    updateButtonStatus();  // 更新前后按钮的状态
                    boxVision();  // 更新主图显示状态
                    updateThumbnails();  // 更新缩略图
                    scrollToActive(); // 滚动条自动跟随
                });
            });
        });

        // 灯箱-更新缩略图
        function updateThumbnails() {
            let thumbnailsDiv = document.getElementById('thumbnails');
            thumbnailsDiv.innerHTML = ''; // 清空现有的缩略图

            images.forEach((image, index) => {
                let wrapper = document.createElement('div');
                wrapper.classList.add('thumbnail-box');

                let thumbnail = document.createElement('img');
                thumbnail.src = image.src;
                thumbnail.classList.add('thumbnail');

                if (index === currentImageIndex) {
                    thumbnail.classList.add('active'); // 标记当前显示的图片
                }
                if (image.parentElement.classList.contains('selected')) {
                    thumbnail.classList.add('thumb-selected'); // 标记当前选定的图片
                }

                // 更新 tools 的位置
                thumbnail.addEventListener('mousemove', function(e) {
                    tools.style.position = 'fixed';
                    tools.style.left = (e.clientX - 80 - 20) + 'px';
                    tools.style.top = (e.clientY - 25 - 10) + 'px';
                });

                // 一个元素需要显示提示
                thumbnail.addEventListener('mouseover', function() {
                    let id = image.getAttribute('data-frame');
                    let time = image.getAttribute('data-timestamp');
                    tools.textContent = id + ' - ' + time;
                    tools.classList.add('tips');
                });
                // 关闭提示
                thumbnail.addEventListener('mouseout', function() {
                    tools.textContent = '';
                    tools.classList.remove('tips');
                });

                thumbnail.addEventListener('click', function(e) {
                    // 点击缩略图时更新大图
                    lightboxImg.src = image.src;
                    frameIdSpan.textContent = image.dataset.frame;
                    timestampSpan.textContent = image.dataset.timestamp;
                    currentImageIndex = index;
                    originalImage = image;
                    updateButtonStatus();
                    boxVision();
                });
                wrapper.appendChild(thumbnail);
                thumbnailsDiv.appendChild(wrapper);
            });
        }

        // 更新主图
        function updateImage() {
            let image = images[currentImageIndex];
            lightboxImg.src = image.src;
            lightboxImg.dataset.frame = image.dataset.frame;
            lightboxImg.dataset.timestamp = image.dataset.timestamp;
            frameIdSpan.textContent = image.dataset.frame;
            timestampSpan.textContent = image.dataset.timestamp;
            originalImage = image;
            updateButtonStatus();
            boxVision();
        }

        // 灯箱-更新按钮状态
        function updateButtonStatus() {
            prevButton.disabled = currentImageIndex === 0;
            nextButton.disabled = currentImageIndex === images.length - 1;
            updateThumbnails(); // 在更新按钮状态时调用缩略图更新函数
        }

        // 灯箱-更新主图标记效果
        function boxVision () {
            let boxImage = document.getElementById('lightbox-img');
            if (originalImage.parentElement.classList.contains('selected')) {
                boxImage.classList.add('box-selected');
            } else {
                boxImage.classList.remove('box-selected');
            }
        }

        function prevButtonAction() {
            if (currentImageIndex > 0) {
                currentImageIndex--;
                updateImage();
                scrollToActive();
            }
        }

        function nextButtonAction() {
            if (currentImageIndex < images.length - 1) {
                currentImageIndex++;
                updateImage();
                scrollToActive();
            }
        }

        // 灯箱-上一张标签
        prevButton.addEventListener('click', function() {
            prevButtonAction();
        });

        // 灯箱-下一张标签
        nextButton.addEventListener('click', function() {
            nextButtonAction();
        });

        // 灯箱-关闭标签
        closeButton.addEventListener('click', function() {
            closeLightbox();
        });

        // 灯箱-重选标签
        reselectButton.addEventListener('click', function(e) {
            let imageContainer = document.querySelectorAll('.image-container');
            let container = imageContainer[diffIndex]
            let markButton = container.querySelectorAll('.image-box button');
            markButton.forEach(mark => {
                mark.classList.remove('marked');
                mark.closest('.image-box').classList.remove('selected');
                mark.closest('.image-box').style.display = '';
            });

            boxSideBar('0 -> 0', 'none', '0.00000', 'none');

            let timeDivs = Array.from(document.querySelectorAll('.time-difference'));
            let resContainers = Array.from(document.querySelectorAll('.result-container'));
            let options = Array.from(document.querySelectorAll('.options'));
            timeDivs[diffIndex].textContent = '0.00000';
            timeDivs[diffIndex].classList.remove('effect-on');
            timeDivs[diffIndex].classList.add('effect-off');
            resContainers[diffIndex].style.display = 'none';
            options[diffIndex].style.display = 'none';

            let allThumb = Array.from(document.querySelectorAll('.thumb-selected'));
            allThumb.forEach(thumb => {
                thumb.classList.remove('thumb-selected');
            });

            images = Array.from(container.querySelectorAll('.image-box img'));

            // 显示全部缩略图
            let thumbs = Array.from(document.querySelectorAll('.thumbnail'));
            thumbs.forEach(thumb => {thumb.style.display = ''});
            updateIndex();

            updateThumbnails();
            scrollToActive();
            updateButtonStatus();

            let boxImage = document.getElementById('lightbox-img');
            boxImage.classList.remove('box-selected');
        });

        // 灯箱-缩略图滚动条自动跟随
        function scrollToActive() {
            let thumbnailsDiv = document.getElementById('thumbnails');
            let thumbnails = thumbnailsDiv.querySelectorAll('.thumbnail');
            let activeThumbnail = thumbnails[currentImageIndex];

            let thumbnailStart = activeThumbnail.offsetLeft;
            let thumbnailEnd = thumbnailStart + activeThumbnail.offsetWidth;

            let viewStart = thumbnailsDiv.scrollLeft;
            let viewEnd = viewStart + thumbnailsDiv.offsetWidth;

            // 判断当前图片是否为可视区域最左侧的第二张
            let isSecondVisibleThumbnail = currentImageIndex === 1 && thumbnailStart >= viewStart && thumbnailEnd <= viewEnd;
            // 缩略图位于视图之外的左侧
            if (thumbnailStart < viewStart && !isSecondVisibleThumbnail) {
                // 让第二张图片出现在可视区域的最左侧
                thumbnailsDiv.scrollLeft = thumbnailStart - thumbnails[0].offsetWidth;
            // 如果缩略图在右侧，看不见
            } else if (thumbnailEnd > viewEnd) {
                thumbnailsDiv.scrollLeft = thumbnailEnd - thumbnailsDiv.offsetWidth;
            }
            // 如果缩略图完全在视图中，则不进行滚动
        }

        // 灯箱-主图点击事件
        lightboxImg.addEventListener('click', function(e) {
            timeCost();
        });

        function timeCost() {
            let parentImage = originalImage.parentElement;
            let buttons = Array.from(parentImage.querySelectorAll('button'));
            let thumbActive = document.querySelector('.thumbnail.active');

            if (parentImage.classList.contains('selected')) {
                lightboxImg.classList.remove('box-selected');
                parentImage.classList.remove('selected');
                buttons.forEach(button => button.classList.remove('marked'));
                thumbActive.classList.remove('thumb-selected');

            } else {
                let resImages =  Array.from(parentImage.parentElement.querySelectorAll('.marked'));
                if (resImages.length < 2) {
                    lightboxImg.classList.add('box-selected');
                    parentImage.classList.add('selected');
                    buttons.forEach(button => button.classList.add('marked'));
                    thumbActive.classList.add('thumb-selected');
                } else {
                    showAlert('已经选择了两个标记，请先取消一个标记再进行操作！');
                    return;
                }
            }

            let resContainers = Array.from(document.querySelectorAll('.result-container'));
            let timeDivs = Array.from(document.querySelectorAll('.time-difference'));
            let resMark = parentImage.parentElement.querySelectorAll('.marked');
            let allImages = Array.from(imageContainers[diffIndex].querySelectorAll('.image-box img'));
            let options = Array.from(document.querySelectorAll('.options'));

            if (resMark.length === 0) {
                allImages.forEach(image => {image.parentElement.style.display = ''}); // 显示所有图片
                timeDivs[diffIndex].textContent = '0.00000';
                timeDivs[diffIndex].classList.remove('effect-on');
                timeDivs[diffIndex].classList.add('effect-off');
                resContainers[diffIndex].style.display = 'none';
                options[diffIndex].style.display = 'none';

                boxSideBar('0 -> 0', 'none', '0.00000', 'none');

                images = allImages;

                // 显示全部缩略图
                let thumbs = Array.from(document.querySelectorAll('.thumbnail'));
                thumbs.forEach(thumb => {thumb.style.display = ''});
                updateIndex();

                updateThumbnails();
                scrollToActive();
                updateButtonStatus();

            } else if (resMark.length === 1) {
                allImages.forEach(image => {image.parentElement.style.display = ''}); // 显示所有图片
                timeDivs[diffIndex].textContent = '0.00000';
                timeDivs[diffIndex].classList.remove('effect-on');
                timeDivs[diffIndex].classList.add('effect-off');
                resContainers[diffIndex].style.display = 'none';
                options[diffIndex].style.display = 'none';

                let diff1 = resMark[0].closest('.image-box').querySelector('img');
                boxSideBar(diff1.dataset.frame, '', '0.00000', 'none');

                images = allImages;

                // 显示全部缩略图
                let thumbs = Array.from(document.querySelectorAll('.thumbnail'));
                thumbs.forEach(thumb => {thumb.style.display = ''});
                updateIndex();

                updateThumbnails();
                scrollToActive();
                updateButtonStatus();

            } else if (resMark.length === 2) {
                allImages.forEach(image => {
                    image.parentElement.style.display = image.parentElement.classList.contains('selected') ? '' : 'none';
                });
                let frame1 = Number(resMark[0].closest('.image-box').querySelector('img').getAttribute('data-frame'));
                let frame2 = Number(resMark[1].closest('.image-box').querySelector('img').getAttribute('data-frame'));
                let timestamp1 = Number(resMark[0].closest('.image-box').querySelector('img').getAttribute('data-timestamp'));
                let timestamp2 = Number(resMark[1].closest('.image-box').querySelector('img').getAttribute('data-timestamp'));
                let diff = Math.abs(timestamp2 - timestamp1).toFixed(5);

                boxSideBar(frame1 + ' -> ' + frame2, '', diff, '');

                timeDivs[diffIndex].textContent = diff;
                timeDivs[diffIndex].classList.add('effect-on');
                timeDivs[diffIndex].classList.remove('effect-off');
                options[diffIndex].style.display = 'flex';
                resContainers[diffIndex].style.display = 'flex';

                // 隐藏缩略图
                images = allImages.filter(img => img.parentElement.style.display === '');
                updateIndex();

                updateThumbnails();
                scrollToActive();
                updateButtonStatus();
            }
        }

        // 找出当前点击图片在新的 images 数组中的索引
        function updateIndex() {
            let originalIndex = originalImage.getAttribute('data-frame');
            for (let i = 0; i < images.length; i++) {
                if (images[i].getAttribute('data-frame') === originalIndex) {
                    currentImageIndex = i;
                }
            }
        }
    </script>

    <!--辅助功能-->
    <script>
        // 开启警告提示框
        function showAlert(message) {
            document.getElementById('custom-alert').style.display = 'block';
            document.querySelector('.alert-message').innerText = message;
        }

        // 关闭警告提示框
        function closeAlert() {
            document.getElementById('custom-alert').style.display = 'none';
        }

        // 复制
        async function copyAction(content) {
            try {
                await navigator.clipboard.writeText(content);
                showNotification('✅ 复制成功！');
            } catch (err) {
                console.error('Clipboard API 复制失败:', err);
                showNotification('❌ 复制失败，请手动复制', true);
            }
        }

        // 显示通知
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;

            // 根据是否是错误状态，切换样式
            notification.classList.toggle('error', isError);
            notification.classList.add('show');

            // 2 秒后隐藏
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2000);
        }

        // 页面加载事件
        window.addEventListener('load', function() {
            // 页面加载完毕后等待1秒再关闭等待动画
            setTimeout(function() {
                const loading = document.getElementById('loading');
                loading.style.display = 'none';
            }, 1000);
            // 页面加载完毕后，将滚动条置于最左侧
            let containers = document.querySelectorAll('.image-container');
            for (var i = 0; i < containers.length; i++) {
                containers[i].scrollLeft = 0;
            }
        });

        // 页面加载完毕后，先计算结果
        document.addEventListener("DOMContentLoaded", function() {
            const imageContainers = document.querySelectorAll('.image-container');
            imageContainers.forEach((container, index) => {
                const startFrame = parseInt(container.getAttribute('data-start'));
                const endFrame = parseInt(container.getAttribute('data-end'));
                const startImage = container.querySelector(`img[data-frame="${startFrame}"]`);
                const endImage = container.querySelector(`img[data-frame="${endFrame}"]`);

                // 比较首尾帧的时间戳
                if (startImage && endImage) {
                    const startTime = parseFloat(startImage.getAttribute('data-timestamp'));
                    const endTime = parseFloat(endImage.getAttribute('data-timestamp'));

                    const difference = endTime - startTime;
                    const resContainers = Array.from(document.querySelectorAll('.result-container'));
                    const timeDivs = Array.from(document.querySelectorAll('.time-difference'));
                    timeDivs[index].textContent = difference.toFixed(5);
                    timeDivs[index].classList.add('effect-on');
                    resContainers[index].style.display = 'flex';
                } else {
                    const timeDivs = Array.from(document.querySelectorAll('.time-difference'));
                    timeDivs[index].classList.add('effect-off');
                }

                // 页面加载时，隐藏非标记的首尾帧
                container.querySelectorAll('.image-box').forEach((box, idx) => {
                    if (!box.classList.contains('selected')) {
                        box.style.display = 'none';
                    }
                });
            });
        });

        // 结果标签，点击后复制
        var singleCopy = Array.from(document.querySelectorAll('.result-container button'));
        singleCopy.forEach(single => {
            single.addEventListener('click', function(e) {
                let rawContent = single.textContent;
                // 尝试将内容转换为数字并保留小数点后五位
                let numberContent = parseFloat(rawContent);
                if (!isNaN(numberContent)) {
                    rawContent = numberContent.toFixed(5);
                }
                // 去除换行、空白等格式
                let cleanContent = rawContent.trim().replace(/\s+/g, ' ');
                copyAction(cleanContent);
            });
        });
        
        // 统一复制逻辑
        document.querySelectorAll('.all-copy').forEach(copyBtn => {
            copyBtn.addEventListener('click', function () {
                const mode = copyBtn.dataset.mode;
                const timeDivs = Array.from(document.querySelectorAll('.time-difference.effect-on'));

                // 横向：一行拼接
                if (mode === 'horizontal') {
                    let line = timeDivs.map(res => {
                        let raw = res.textContent.trim().replace(/\s+/g, '');
                        let num = parseFloat(raw);
                        return isNaN(num) ? raw : num.toFixed(5);
                    }).join('\t');
                    copyAction(line);
                }

                // 竖向：一列拼接
                else if (mode === 'vertical') {
                    let lines = timeDivs.map(res => {
                        let raw = res.textContent.trim().replace(/\s+/g, '');
                        let num = parseFloat(raw);
                        return isNaN(num) ? raw : num.toFixed(5);
                    }).join('\n');
                    copyAction(lines);
                }
            });
        });

        // 全部重选按钮
        var againButtons = Array.from(document.querySelectorAll('.all-reselect'));
        againButtons.forEach((again, index) => {
            again.addEventListener('click', function(e) {
                let resMarked = document.querySelectorAll('.marked');
                resMarked.forEach(marked => {
                    marked.classList.remove('marked');
                })
                let resSelected = document.querySelectorAll('.selected');
                resSelected.forEach(selected => {
                    selected.classList.remove('selected');
                })
                let allImageBox = document.querySelectorAll('.image-container .image-box');
                allImageBox.forEach(imageBox => {
                    imageBox.style.display = '';
                });
                let resContainers = Array.from(document.querySelectorAll('.result-container'));
                resContainers.forEach(res => {
                    res.style.display = 'none'
                });
                let timeDiff = Array.from(document.querySelectorAll('.time-difference'));
                timeDiff.forEach(diff => {
                    diff.textContent = '0.00000';
                    diff.classList.remove('effect-on');
                    diff.classList.add('effect-off');
                });
                let options = Array.from(document.querySelectorAll('.options'));
                options.forEach(option => {
                    option.style.display = 'none';
                });
                boxSideBar('0 -> 0', '0.00000', 'none');
            });
        });
    </script>

    <!--灯箱内的键盘事件-->
    <script>
        function keyListener(event) {
            switch (event.key) {
                case "ArrowLeft":
                    // 左箭头键被按下时执行的代码
                    prevButtonAction();
                    break;
                case "ArrowRight":
                    // 右箭头键被按下时执行的代码
                    nextButtonAction();
                    break;
                case "Enter":
                    // 回车键被按下时执行的代码
                    timeCost();
                    break;
                case "Escape":
                    // Escape键被按下时执行的代码
                    closeLightbox();
                    break;
            }
        }
    </script>

    <!--背景动画-->
    <script>
        let canvas, ctx, particles, particlePool;

        window.addEventListener('DOMContentLoaded', function() {
            init();
        });

        function init() {
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            particles = [];
            particlePool = [];

            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            window.addEventListener('scroll', resizeCanvas);

            loop();
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.velX = Math.random() * 0.5 - 0.25;
                this.velY = Math.random() * 0.5 - 0.25;
                this.size = Math.random() * 5 + 2;
                this.life = 500;
                this.color = `hsla(${Math.random() * 360}, 100%, 50%, 1)`;
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.shadowBlur = 15;
                ctx.shadowColor = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }

            update() {
                this.x += this.velX;
                this.y += this.velY;
                this.life--;
                if (this.size > 0.2) this.size -= 0.05;
            }
        }

        function createParticle(x, y) {
            const particle = particlePool.pop() || new Particle(x, y);
            particle.x = x;
            particle.y = y;
            particle.life = 500;
            particle.size = Math.random() * 5 + 2;
            particles.push(particle);
        }

        function loop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (Math.random() < 0.3) {
                createParticle(Math.random() * canvas.width, Math.random() * canvas.height);
            }

            particles.forEach((particle, index) => {
                particle.draw();
                particle.update();

                if (particle.life <= 0) {
                    particlePool.push(particles.splice(index, 1)[0]);
                }
            });

            requestAnimationFrame(loop);
        }
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js "></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js "></script>
</body>
</html>
