<!--
  _____                    _      _____                    _       _
 |  ___| __ __ _ _ __ ___ (_)_  _|_   _|__ _ __ ___  _ __ | | __ _| |_ ___
 | |_ | '__/ _` | '_ ` _ \| \ \/ / | |/ _ \ '_ ` _ \| '_ \| |/ _` | __/ _ \
 |  _|| | | (_| | | | | | | |>  <  | |  __/ | | | | | |_) | | (_| | ||  __/
 |_|  |_|  \__,_|_| |_| |_|_/_/\_\ |_|\___|_| |_| |_| .__/|_|\__,_|\__\___|
                                                    |_|

ç‰ˆæƒæ‰€æœ‰ (c) 2024  Framix(ç”»å¸§ç§€)
æ­¤æ–‡ä»¶å— Framix(ç”»å¸§ç§€) è®¸å¯è¯çš„ä¿æŠ¤ã€‚æ‚¨å¯ä»¥åœ¨ LICENSE.md æ–‡ä»¶ä¸­æŸ¥çœ‹è¯¦ç»†çš„è®¸å¯æ¡æ¬¾ã€‚

Copyright (c) 2024  Framix(ç”»å¸§ç§€)
This file is licensed under the Framix(ç”»å¸§ç§€) License. See the LICENSE.md file for more details.
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <title>ç”»å¸§ç§€ - Main - Share</title>
    <style>
        /* åŠ è½½åŠ¨ç”» */
        #loading {
            position: fixed;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            z-index: 9999;
        }
        .spinner-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        .spinner {
            border: 20px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 20px solid #deff07;
            width: 200px;
            height: 200px;
            position: absolute;
            animation: spin 1s linear infinite;
        }
        .loading-text {
            font-size: 16px;
            font-weight: bold;
            transform: translate(-50%, -50%);
        }
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* èƒŒæ™¯ç²’å­ç‰¹æ•ˆ */
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
            background: linear-gradient(to top, #ada996, #f2f2f2, #dbdbdb, #eaeaea);
        }

        /* å®šä¹‰æ»šåŠ¨æ¡çš„å®½åº¦ */
        ::-webkit-scrollbar {
            width: 10px;
        }
        /* å®šä¹‰æ»šåŠ¨æ¡è½¨é“çš„æ ·å¼ */
        ::-webkit-scrollbar-track {
            box-shadow: inset 0 0 5px grey;
            border-radius: 10px;
        }
        /* å®šä¹‰æ»šåŠ¨æ»‘å—çš„æ ·å¼ */
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        /* å½“æ»‘å—è¢«é¼ æ ‡æ‚¬åœæˆ–ç‚¹å‡»æ—¶ï¼Œæ”¹å˜é¢œè‰² */
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* ç»“æœæ ‡ç­¾å®¹å™¨ */
        .result-container {
            display: flex;
            align-items: center;
            margin: 10px;
        }
        /* ç»“æœæ ‡ç­¾ */
        .effect-on::before, .effect-on::after {
            display: block;
        }
        .effect-off::before, .effect-off::after {
            display: none;
        }
        .time-difference.effect-off {
            border: 1px solid #e2e5e9;
            background-image: linear-gradient(45deg, #8BAAAA 0%, #AE8B9C 100%);
            pointer-events: none;
        }
        .time-difference:hover {
            padding: 5px 5px;
            border: 1px solid #e1b100;
            background-color: #e1b100;
            transition: background-color 0.3s;
        }
        .time-difference:active {
            transform: scale(0.95);
        }
        .time-difference:hover::before, .time-difference:hover::after {
            background-color: #2a2626;  /* å¢åŠ å¯¹æ¯” */
            transition: background-color 0.3s; /* å¹³æ»‘è¿‡æ¸¡æ•ˆæœ */
        }
        .time-difference {
            position: relative;
            width: 120px;
            padding: 5px 20px;
            border-radius: 10px;
            border: 1px solid #d2e100;
            background-color: #d2e100;
            color: #2a2626;
            cursor: pointer;
            outline: none;
            overflow: hidden;
            font-weight: bold;
        }
        .time-difference::before, .time-difference::after {
            content: "";
            position: absolute;
            width: 10%;
            height: 2px;
            background-color: #fff;  /* è¿™æ˜¯çº¿æ¡çš„é¢œè‰² */
            transition: all 0.5s;
        }
        .time-difference::before {
            top: 0;
            left: 0;
            transform: translateY(-100%);
            animation: topLine 1s infinite;
        }
        .time-difference::after {
            bottom: 0;
            right: 0;
            transform: translateY(100%);
            animation: bottomLine 1s infinite;
        }
        @keyframes topLine {
            0%, 100% {
                left: 0;
                top: 0;
                transform: translateY(-100%);
            }
            25% {
                left: 100%;
                top: 0;
                transform: translateX(100%);
            }
            50% {
                left: 100%;
                top: 100%;
                transform: translateY(100%);
            }
            75% {
                left: 0;
                top: 100%;
                transform: translateX(-100%);
            }
        }
        @keyframes bottomLine {
            0%, 100% {
                right: 0;
                bottom: 0;
                transform: translateY(100%);
            }
            25% {
                right: 100%;
                bottom: 0;
                transform: translateX(-100%);
            }
            50% {
                right: 100%;
                bottom: 100%;
                transform: translateY(-100%);
            }
            75% {
                right: 0;
                bottom: 100%;
                transform: translateX(100%);
            }
        }

        /* æ ‡é¢˜ */
        .h1-container {
            display: flex;
            justify-content: center;
            letter-spacing: 1px;
            border-bottom: 2px solid #888;
        }
        h1 {
            font-size: 42px;
            color: rgb(90, 90, 90);
            padding: 10px 20px;
            border: 2px solid #8c8c8c;
            border-radius: 10px;
            box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            display: inline-block;
            margin: 20px;
            text-transform: uppercase;
            transition: all 0.3s ease-in-out;
        }
        h1:hover {
            background-image: linear-gradient(to top, #f3e7e9 0%, #e3eeff 99%, #e3eeff 100%);
            cursor: grab;
        }

        /* ä¸»å®¹å™¨ */
        .container {
            position: relative;
            max-width: 90%;
            background-color: hsla(0, 100%, 100%, 0);
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px; /* å†…è¾¹è· */
            overflow: hidden; /* éšè—æº¢å‡ºçš„å†…å®¹ï¼Œä»¥ä¿æŒåœ†è§’æ•ˆæœ */
        }
        /* ä¸€ç»„å›¾ç‰‡çš„å®¹å™¨ */
        .image-container {
            display: flex;
            overflow-x: auto;
            margin: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        /* ä¸€å¼ å›¾ç‰‡çš„å®¹å™¨ */
        .image-box {
            width: 100%;
            border-radius: 10px;
            margin: 20px 10px;
            text-align: center;
        }
        .image-box:hover {
            transform: scale(1.01);
            box-shadow: 0px 0px 10px 2px rgb(233 177 10 / 90%);
            transition: transform 0.3s ease, box-shadow 0.5s ease;
        }
        .image-box img {
            max-height: 80%;
            max-width: 90%;
            margin: 10px auto;
            border-radius: 10px;
        }
        .image-box img:hover {
            transform: scale(1.01);
            box-shadow: 0px 0px 1px 0px rgb(0 0 0 / 90%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: zoom-in;
        }
        .image-box img:active {
            transform: scale(0.95);
        }
        .info {
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            margin: 5px;
            color: #eb4d4b;
        }

        /* å›¾ç‰‡è¢«é€‰æ‹© */
        .selected {
            transform: scale(1.01);
            box-shadow: 0px 0px 10px 2px rgb(228 63 36 / 90%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .selected:hover {
            transform: scale(1.02);
            box-shadow: 0px 0px 10px 2px rgb(200 36 228 / 90%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        /* æ ‡è®°æ ‡ç­¾ */
        .mark-button {
            border: none;
            font-size: 12px;
            padding: 1px 20%;
            cursor: pointer;
            background-color: #2481e4;
            color: white;
            border-radius: 10px;
            transition: background-color 0.3s ease;
        }
        .mark-button:hover {
            padding: 1px 18%;
            background-color: #e9b10a;
            transition: padding 0.5s ease, background-color 0.5s ease;
        }
        .mark-button:active {
            transform: scale(0.95);
        }
        .marked {
            background-color: #e43f24;
            transition: background-color 0.3s ease;
        }

        /* ç¯ç®±æŸ¥çœ‹å™¨ */
        #lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            transition: opacity 0.3s, transform 0.3s;
        }
        #lightbox.show {
            display: flex;
            opacity: 1;
            transform: scale(1);
        }
        .content {
            position: relative;
            width: 95%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: transparent;
            box-shadow: 0px 0px 10px 6px rgb(231 186 13 / 90%);
            padding: 20px;
        }
        .nav-button {
            padding: 5px 20px;
            margin: 5px;
            border: none;
            border-radius: 10px;
            background-color: #17a2b8;
            color: white;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .nav-button:hover {
            cursor: pointer;
            background-color: #1296dd;
        }
        .nav-button:active {
            transform: scale(0.95);
        }
        .nav-button:disabled {
            cursor: not-allowed;
            transform: none;
            background-color: #CCCCCC;
            color: #666666;
        }
        #close, #reselect {
            cursor: pointer;
            padding: 5px 20px;
            margin: 5px;
            border: none;
            border-radius: 10px;
            background-color: #ffdb6f;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        #close:hover, #reselect:hover {
            transform: scale(1.05);
            color: #d91212;
            background-color: #dfab10;
        }
        #close:active, #reselect:active {
            transform: scale(0.95);
        }
        #close:disabled, #reselect:disabled {
            background-color: #CCCCCC;
            color: #666666;
        }
        #info-wrapper {
            display: flex;
            text-align: center;
        }
        .img-info, .lightbox-logo {
            margin: 0 10px 20px;
            padding: 5px;
            border-radius: 10px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .img-info {
            width: 150px;
            color: #f2620bcc;
            background-color: #f8f3df;
        }
        .lightbox-logo {
            width: 80px;
            color: #4682b4;
            background-image: linear-gradient(to top, #D5DEE7 0%, #ffafbd 0%, #C9FFBF 100%);
        }
        .img-info > p, .lightbox-logo > p {
            margin: auto;
        }
        .img-info:hover {
            cursor: grab;
            color: #f8f3df;
            background-color: #f2620bcc;
            transition: background-color 0.3s ease;
        }
        .lightbox-logo:hover {
            cursor: grab;
            color: #ff1493;
            background-image: linear-gradient(-225deg, #E3FDF5 0%, #FFE6FA 100%);
        }
        .img-info:active, .lightbox-logo:active {
            transform: scale(0.95);
        }
        #lightbox-img {
            max-width: 60%;
            height: 60%;
            margin: 10px;
            object-fit: cover;
            border-radius: 10px;
            box-shadow: 0px 0px 10px 6px rgb(242 242 11 / 45%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        #lightbox-img:hover {
            transform: scale(1.02);
            box-shadow: 0px 0px 10px 6px rgb(242 242 11 / 90%);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        #lightbox-img:active {
            transform: scale(1);
        }
        #lightbox-img.box-selected {
            box-shadow: 0px 0px 10px 6px rgb(242 98 11 / 90%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        #thumbnails {
            display: flex;
            overflow-x: auto;
            overflow-y: hidden;
            width: 100%;
            white-space: nowrap;
            transition: all 0.3s ease;
        }
        .thumbnail {
            max-width: 30%;
            margin: 20px 10px;
            border-radius: 10px;
            cursor: pointer;
        }
        .thumbnail:hover {
            transform: scale(0.97);
            transition: transform 0.3s ease;
        }
        .thumbnail.active {
            transform: scale(0.97);
            box-shadow: 0px 0px 5px 3px rgb(242 242 11 / 90%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .thumb-selected {
            transform: scale(0.97);
            box-shadow: 0px 0px 5px 3px rgb(242 98 11 / 90%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .thumbnail.thumb-selected.active {
            transform: scale(0.97);
            box-shadow: 0px 0px 5px 3px rgb(17 184 241 / 90%);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .thumbnail.active:hover, .thumb-selected:hover, .thumbnail.thumb-selected.active:hover {
            transform: scale(0.95);
            opacity: 0.5;
        }

        /* è­¦å‘Šæç¤ºæ¡† */
        .alert {
            display: none;
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .alert-btn {
            padding: 1px 8px;
            border-radius: 10px;
            background-color: #a3e20d;
        }
        .alert-btn:hover {
            background-color: #e2dc0d;
            transition: background-color 0.3s ease;
        }
        .alert-btn:active {
            transform: scale(0.95);
        }
        .alert-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            border-radius: 10px;
            background-color: #fff;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.2);
        }
        .alert-message {
            margin-right: 10px;
        }

        /* ğŸ”¹ é€šçŸ¥æ¡†åŸºç¡€æ ·å¼ */
        #notification {
            display: none; /* é»˜è®¤éšè— */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* å®Œå…¨å±…ä¸­ */
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #28a745, #218838); /* ç»¿è‰²æ¸å˜èƒŒæ™¯ */
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        /* ğŸ”¹ å¤åˆ¶å¤±è´¥æ—¶çš„çº¢è‰²æ ·å¼ */
        #notification.error {
            background: linear-gradient(135deg, #dc3545, #c82333); /* çº¢è‰²æ¸å˜èƒŒæ™¯ */
        }
        /* ğŸ”¹ æ˜¾ç¤ºé€šçŸ¥æ—¶çš„åŠ¨ç”» */
        #notification.show {
            display: block;
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.1); /* å±…ä¸­å¹¶æ”¾å¤§ä¸€ç‚¹ */
        }

        /* é€‰é¡¹æ ‡ç­¾ */
        .options {
            display: flex;
            margin: 10px;
            align-items: center;
        }
        .option-one, .option-two {
            display: flex;
            flex-direction: column;
            gap: 10px;  /* æŒ‰é’®ä¹‹é—´çš„é—´è· */
        }
        .all-copy, .all-reselect, .quick-reselect, .ex-info, .proto-link {
            margin: 10px;
            padding: 1px 20px;
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s;
        }
        .all-copy, .all-reselect, .quick-reselect {
            background: linear-gradient(to left, #007991, #00eaa3);
        }
        .ex-info, .proto-link {
            background: linear-gradient(to right, #56ccf2, #2f80ed);
        }
        .proto-link {
            text-decoration: none;
        }
        .all-copy:hover, .all-reselect:hover, .quick-reselect:hover, .ex-info:hover, .proto-link:hover {
            background: linear-gradient(to left, #00eaa3, #007991);
            transition: all 0.3s;
        }
        .ex-info:hover, .proto-link:hover {
            background: linear-gradient(to right, #2f80ed, #56ccf2);
            transition: all 0.3s;
        }
        .proto-link:hover {
            text-decoration: none;
            color: white;
        }
        .all-copy:active, .all-reselect:active, .quick-reselect:active, .ex-info:active, .proto-link:active {
            transform: scale(0.95);
        }
        .proto-link:visited {
            color: #616161;
        }

        /* ç¯ç®±-è®¡ç®—ç»“æœæç¤º */
        .box-res {
            margin: 5px;
            font-weight: bold;
            padding: 1px 5px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(to top, #dce35b, #45b649);
        }
        .box-res:last-child {
            cursor: copy;
        }
        .box-res:last-child:hover {
            background: linear-gradient(to top, #f79d00, #64f38c);
        }
        .box-res:last-child:active {
            transform: scale(0.95);
        }
        .box-res p {
            color: #8e44ad;
            margin: 5px;
            text-align: center;
        }

        /* ç¯ç®±-ç¼©ç•¥å›¾æ‚¬æµ®æç¤º */
        .thumbnail-box {
            display: contents;
        }
        .thumbnail-box .tips {
            visibility: hidden;
            background-image: linear-gradient(180deg, #e96567, #f19072, #f6b87d, #f9df88);
            margin: 5px;
            color: #131313;
            font-weight: bold;
            text-align: center;
            padding: 1px 5px;
            border-radius: 10px;
            /* å®šä½ */
            position: absolute;
            z-index: 1;
            top: 32%;
            left: 0;
        }
        .thumbnail-box:hover .tips {
            visibility: visible;
        }
        #tooltip {
            color: #131313;
            font-weight: bold;
            text-align: center;
            position: absolute;
            display: none;
            background-image: linear-gradient(180deg, #e96567, #f19072, #f6b87d, #f9df88);
            padding: 1px 5px;
            border-radius: 10px;
        }

        /* æ¨ªå±æ¨¡å¼ */
        @media screen and (orientation: landscape) {
            .image-container {
                max-height: 60vh;
            }
            .image-box {
                flex: 0 0 calc(12.5% - 20px);
            }
            .content {
                height: 95%;
            }
            #thumbnails {
                height: 30%;
            }
            .box-res {
                width: 10%;
            }
            .thumbnail-box .tips {
                width: 10%;
            }
        }
        /* ç«–å±æ¨¡å¼ */
        @media screen and (orientation: portrait) {
            .image-container {
                max-height: 30vh;
            }
            .image-box {
                flex: 0 0 calc(25% - 20px);
            }
            .content {
                height: 55%;
            }
            #thumbnails {
                height: 40%;
            }
            .box-res {
                width: 15%;
            }
            .thumbnail-box .tips {
                width: 15%;
            }
        }
    </style>
</head>
<body>
    <!--åŠ è½½åŠ¨ç”»-->
    <div id="loading">
        <div class="spinner-container">
            <div class="spinner"></div>
            <div class="loading-text">Loading...</div>
        </div>
    </div>

    <!--èƒŒæ™¯åŠ¨ç”»-->
    <canvas id="canvas"></canvas>

    <!--å›¾ç‰‡é€‰æ‹©-->
    <div class="container">
        <div class="h1-container">
            <h1 class="text-center">{{ title }}</h1>
        </div>
        {% for res in images_list %}
        <div class="image-container" data-query="{{ res.query }}" data-start="{{ res.stage.start }}" data-end="{{ res.stage.end }}">
            {% for image in res.image_list %}
            <div class="image-box {{ 'selected' if (image.frames_id| int) == res.stage.start or (image.frames_id| int) == res.stage.end else '' }}" style="display: {{ 'none' if (image.frames_id| int) != res.stage.start and (image.frames_id| int) != res.stage.end else '' }}">
                <img src="{{ image.src }}" class="img-fluid" alt="Image" data-frame="{{ image.frames_id }}" data-timestamp="{{ image.timestamp }}">
                <div class="mark-button-div">
                    <button class="mark-button {{ 'marked' if (image.frames_id| int) == res.stage.start or (image.frames_id| int) == res.stage.end else '' }}">æ ‡è®°</button>
                </div>
                <div class="info">
                    <span>{{ image.frames_id }} - {{ image.timestamp }}</span>
                </div>
            </div>
            {% endfor %}

            <!--ç»“æœ-->
            <div class="result-container">
                <button id="timeDifference{{ loop.index }}" class="time-difference">{{ res.stage.cost }}</button>
            </div>

            <!--é€‰é¡¹-->
            <div class="options">
                <div class="option-one">
                    <button class="all-copy">å…¨éƒ¨å¤åˆ¶</button>
                    <button class="all-reselect">å…¨éƒ¨é‡é€‰</button>
                    <button class="quick-reselect">å¿«é€Ÿé‡é€‰</button>
                </div>
                {% if 'proto' in res %}
                <div class="option-two">
                    <button class="ex-info">é¢å¤–å¸§</button>
                    <a href="{{ res.proto }}" target="_blank" class="proto-link">é˜¶æ®µå¸§</a>
                </div>
                {% endif %}
            </div>

            <!--é¢å¤–å¸§-->
            {% if 'extra_list' in res %}
            <div class="extra" style="display: none;">
                <div class="extra-container">
                    {% for extra in res.extra_list %}
                    <div class="extra-image">
                        <img src="{{ extra.src }}" class="img-extra" alt="extraImage">
                        <p>{{ extra.idx }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

        </div>
        {% endfor %}
    </div>

    <!--ç¯ç®±æŸ¥çœ‹å™¨-->
    <div id="lightbox">
        <div class="content">
            <button id="prev" class="nav-button" style="position: absolute; left: 0;"><<< Prev</button>
            <div id="info-wrapper">
                <div class="img-info">
                    <p>ID: <span id="frame-id"></span></p>
                </div>
                <div class="lightbox-logo">
                    <p><span id="box-logo">{{ name }}</span></p>
                </div>
                <div class="img-info">
                    <p>TS: <span id="timestamp"></span></p>
                </div>
            </div>
            <img id="lightbox-img" src="" alt="Image" data-frame="" data-timestamp="">
            <div id="thumbnails"></div>
            <button id="next"  class="nav-button" style="position: absolute; right: 0;">Next >>></button>
            <button id="close" style="position: absolute; top: 0; right: 0;">X</button>
            <button id="reselect" style="position: absolute; top: 0; left: 0;">R</button>
            <div class="box-res" style="position: absolute; top: 18%; left: 0;">
                <p id="box-diff1">0 -> 0</p>
            </div>
            <div class="box-res" style="position: absolute; top: 25%; left: 0;">
                <p id="box-diff2">0.00000</p>
            </div>
        </div>
    </div>

    <!--è­¦å‘Šæç¤ºæ¡†-->
    <div id="custom-alert" class="alert">
        <div class="alert-content">
            <span class="alert-message"></span>
            <button class="alert-btn" onclick="closeAlert()">ç¡®å®š</button>
        </div>
    </div>

    <!--ç¼©ç•¥å›¾æ‚¬æµ®æç¤º-->
    <div id="tooltip"></div>

    <!--å¤åˆ¶æç¤ºæ¡†-->
    <div id="notification"></div>

    <!--å¤åˆ¶æç¤ºæ¡†-->
    <div id="toast" class="toast"></div>

    <!--ä¸»é¡µå›¾ç‰‡é€‰æ‹©å™¨-->
    <script>
        var containers = document.querySelectorAll('.image-container');
        containers.forEach((container, idx) => {
            container.querySelectorAll('.mark-button').forEach(markButton => {
                markButton.addEventListener('click', function(e) {
                    var target = e.target;
                    var parent = target.closest('.image-box');;
                    var frameId = Number(parent.querySelector('img').getAttribute('data-frame'));
                    var frame = Number(parent.querySelector('img').getAttribute('data-timestamp'));

                    if (target.classList.contains('marked')) {
                        target.classList.remove('marked');
                        parent.classList.remove('selected');
                    } else {
                        var markedInContainer = container.querySelectorAll('.marked');
                        if (markedInContainer.length < 2) {
                            target.classList.add('marked');
                            parent.classList.add('selected');
                        } else {
                            showAlert('å·²ç»é€‰æ‹©äº†ä¸¤ä¸ªæ ‡è®°ï¼Œè¯·å…ˆå–æ¶ˆä¸€ä¸ªæ ‡è®°å†è¿›è¡Œæ“ä½œï¼');
                            return;
                        }
                    }

                    // è·å–æ‰€æœ‰çš„ç»“æœæ ‡ç­¾
                    let resContainers = Array.from(document.querySelectorAll('.result-container'));
                    let timeDivs = Array.from(document.querySelectorAll('.time-difference'));
                    // é‡æ–°è·å–é€‰ä¸­çš„å…ƒç´ 
                    selectedInContainer = container.querySelectorAll('.selected');
                    let allImages = Array.from(containers[idx].querySelectorAll('.image-box img'));
                    let options = Array.from(document.querySelectorAll('.options'));

                    // å¦‚æœæœ‰ä¸¤ä¸ªé€‰ä¸­çš„å…ƒç´ ï¼Œè·å–å®ƒä»¬çš„å¸§æ•°æ®å¹¶è®¡ç®—å·®å€¼
                    if (selectedInContainer.length === 2) {
                        timeDivs[idx].classList.add('effect-on');
                        timeDivs[idx].classList.remove('effect-off');
                        options[idx].style.display = 'flex';
                        allImages.forEach(image => {
                            if (!image.parentElement.classList.contains('selected')) {
                                image.parentElement.style.display = 'none';
                            }
                        });

                        var timestamp1 = Number(selectedInContainer[0].querySelector('img').getAttribute('data-timestamp'));
                        var timestamp2 = Number(selectedInContainer[1].querySelector('img').getAttribute('data-timestamp'));
                        timeDivs[idx].textContent = Math.abs(timestamp2 - timestamp1).toFixed(5);
                        resContainers[idx].style.display = 'flex';
                    } else {
                        // å¦‚æœé€‰ä¸­çš„æ ‡è®°å°‘äºä¸¤ä¸ªï¼Œæ¸…ç©ºç»“æœæ˜¾ç¤º
                        timeDivs[idx].textContent = '0.00000';
                        timeDivs[idx].classList.remove('effect-on');
                        timeDivs[idx].classList.add('effect-off');
                        resContainers[idx].style.display = 'none';
                        options[idx].style.display = 'none';
                        // æ˜¾ç¤ºè¯¥å®¹å™¨çš„æ‰€æœ‰å›¾ç‰‡
                        allImages.forEach(image => {
                            if (image.parentElement.style.display === 'none') {
                                image.parentElement.style.display = '';
                            }
                        });
                    }
                });
            });
        });

        // å¿«é€Ÿé‡é€‰
        var quickButtons = document.querySelectorAll('.quick-reselect');
        quickButtons.forEach((quick, idx) => {
            quick.addEventListener('click', function(e) {
                let resContainers = Array.from(document.querySelectorAll('.result-container'));
                let timeDivs = Array.from(document.querySelectorAll('.time-difference'));
                let options = Array.from(document.querySelectorAll('.options'));
                resContainers[idx].style.display = 'none';
                timeDivs[idx].textContent = '0.00000';
                timeDivs[idx].classList.remove('effect-on');
                timeDivs[idx].classList.add('effect-off');
                options[idx].style.display = 'none';
                boxSideBar('0 -> 0', 'none', '0.00000', 'none');

                let quickParent = e.currentTarget.closest('.image-container');
                marked = quickParent.querySelectorAll('.marked');
                marked.forEach(mark => {mark.classList.remove('marked')});
                selected = quickParent.querySelectorAll('.selected');
                selected.forEach(select => {select.classList.remove('selected')});

                boxImage = quickParent.querySelectorAll('.image-box');
                boxImage.forEach(box => {box.style.display = ''});
                images = Array.from(quickParent.querySelectorAll('.image-box img'));
                diffIndex = idx;  // è·å–å½“å‰å®¹å™¨çš„ç´¢å¼•
                currentImageIndex = 0;  // è·å–å½“å‰å›¾ç‰‡çš„ç´¢å¼•
                let firstImage = images[currentImageIndex];

                openLightbox();
                lightboxImg.src = firstImage.src;
                lightboxImg.dataset.frame = firstImage.dataset.frame;
                lightboxImg.dataset.timestamp = firstImage.dataset.timestamp;
                frameIdSpan.textContent = firstImage.dataset.frame;
                timestampSpan.textContent = firstImage.dataset.timestamp;

                originalImage = firstImage;  // è·å–åŸå§‹å›¾ç‰‡çš„ä¿¡æ¯
                updateButtonStatus();  // æ›´æ–°å‰åæŒ‰é’®çš„çŠ¶æ€
                boxVision();  // æ›´æ–°ä¸»å›¾æ˜¾ç¤ºçŠ¶æ€
                updateThumbnails();  // æ›´æ–°ç¼©ç•¥å›¾
                scrollToActive(); // æ»šåŠ¨æ¡è‡ªåŠ¨è·Ÿéš
            });
        });

        // è®¾ç½®ç¯ç®±ç»“æœ
        function boxSideBar(diff1, vision1, diff2, vision2) {
            let boxDiff1 = document.querySelector('#box-diff1');
            let boxDiff2 = document.querySelector('#box-diff2');
            boxDiff1.textContent = diff1;
            boxDiff1.parentElement.style.display = vision1;
            boxDiff2.textContent = diff2;
            boxDiff2.parentElement.style.display = vision2;
        }

        // ç¯ç®±ç»“æœæ ‡ç­¾çš„ç‚¹å‡»äº‹ä»¶
        var boxResult = document.querySelectorAll('.box-res:last-child');
        boxResult.forEach((res, idx) => {
            res.addEventListener('click', function(e) {
                resp = res.querySelector('p');
                let rawContent = resp.textContent;
                // å°è¯•å°†å†…å®¹è½¬æ¢ä¸ºæ•°å­—å¹¶ä¿ç•™å°æ•°ç‚¹åäº”ä½
                let numberContent = parseFloat(rawContent);
                if (!isNaN(numberContent)) {
                    rawContent = numberContent.toFixed(5);
                }
                // å»é™¤æ¢è¡Œã€ç©ºç™½ç­‰æ ¼å¼
                let cleanContent = rawContent.trim().replace(/\s+/g, ' ');
                copyAction(cleanContent);
            });
        });
    </script>

    <!--ç¯ç®±æŸ¥çœ‹å™¨-->
    <script>
        var lightbox = document.getElementById('lightbox');
        var lightboxImg = document.getElementById('lightbox-img');
        var frameIdSpan = document.getElementById('frame-id');
        var timestampSpan = document.getElementById('timestamp');
        var prevButton = document.getElementById('prev');
        var nextButton = document.getElementById('next');
        var closeButton = document.getElementById('close');
        var reselectButton = document.getElementById('reselect');
        var tools = document.getElementById('tooltip');

        var imageContainers = Array.from(document.querySelectorAll('.image-container'));
        var images = [];
        var currentImageIndex = 0;
        var originalImage;
        var diffIndex;

        // æ‰“å¼€ç¯ç®±
        function openLightbox() {
            lightbox.classList.add('show');
            window.addEventListener('keydown', keyListener); // å¯ç”¨é”®ç›˜ç›‘å¬
        }

        // å…³é—­ç¯ç®±
        function closeLightbox() {
            lightbox.classList.remove('show');
            window.removeEventListener('keydown', keyListener); // åœæ­¢é”®ç›˜ç›‘å¬
        }

        // ç›‘å¬æ¯ä¸ªå®¹å™¨çš„å›¾ç‰‡ç‚¹å‡»äº‹ä»¶
        imageContainers.forEach((imageContainer, containerIndex) => {
            var currentImages = Array.from(imageContainer.querySelectorAll('.image-box img'));
            currentImages.forEach((image, index) => {
                image.addEventListener('click', function(e) {
                    openLightbox();
                    lightboxImg.src = e.target.src;
                    lightboxImg.dataset.frame = e.target.dataset.frame;
                    lightboxImg.dataset.timestamp = e.target.dataset.timestamp;
                    frameIdSpan.textContent = e.target.dataset.frame;
                    timestampSpan.textContent = e.target.dataset.timestamp;
                    diffIndex = containerIndex;  // è·å–å½“å‰å®¹å™¨çš„ç´¢å¼•
                    currentImageIndex = index;  // è·å–å½“å‰å›¾ç‰‡çš„ç´¢å¼•

                    let selectedImage = Array.from(imageContainer.querySelectorAll('.selected'));
                    if (selectedImage.length === 0) {
                        // æ˜¾ç¤ºç¼©ç•¥å›¾
                        images = currentImages;
                        boxSideBar('0 -> 0', 'none', '0.00000', 'none');
                    
                    } else if (selectedImage.length === 1) {
                        // æ˜¾ç¤ºç¼©ç•¥å›¾
                        images = currentImages;
                        currentImageIndex = images.indexOf(e.target);
                        let diff1 = selectedImage[0].querySelector('img');
                        boxSideBar(diff1.dataset.frame, '', '0.00000', 'none');

                    } else if (selectedImage.length === 2) {
                        // éšè—ç¼©ç•¥å›¾
                        images = currentImages.filter(img => img.parentElement.style.display === '');
                        currentImageIndex = images.indexOf(e.target);
                        let frame1 = Number(selectedImage[0].querySelector('img').getAttribute('data-frame'));
                        let frame2 = Number(selectedImage[1].querySelector('img').getAttribute('data-frame'));
                        let timestamp1 = Number(selectedImage[0].querySelector('img').getAttribute('data-timestamp'));
                        let timestamp2 = Number(selectedImage[1].querySelector('img').getAttribute('data-timestamp'));
                        let diff = Math.abs(timestamp2 - timestamp1).toFixed(5);
                        boxSideBar(frame1 + ' -> ' + frame2, '', diff, '');
                    }

                    originalImage = e.target;  // è·å–åŸå§‹å›¾ç‰‡çš„ä¿¡æ¯
                    updateButtonStatus();  // æ›´æ–°å‰åæŒ‰é’®çš„çŠ¶æ€
                    boxVision();  // æ›´æ–°ä¸»å›¾æ˜¾ç¤ºçŠ¶æ€
                    updateThumbnails();  // æ›´æ–°ç¼©ç•¥å›¾
                    scrollToActive(); // æ»šåŠ¨æ¡è‡ªåŠ¨è·Ÿéš
                });
            });
        });

        // ç¯ç®±-æ›´æ–°ç¼©ç•¥å›¾
        function updateThumbnails() {
            let thumbnailsDiv = document.getElementById('thumbnails');
            thumbnailsDiv.innerHTML = ''; // æ¸…ç©ºç°æœ‰çš„ç¼©ç•¥å›¾

            images.forEach((image, index) => {
                let wrapper = document.createElement('div');
                wrapper.classList.add('thumbnail-box');

                let thumbnail = document.createElement('img');
                thumbnail.src = image.src;
                thumbnail.classList.add('thumbnail');

                let tipText = document.createElement('span');
                tipText.classList.add('tips');
                let id = image.getAttribute('data-frame');
                let time = image.getAttribute('data-timestamp');
                tipText.textContent = id + ' - ' + time;

                if (index === currentImageIndex) {
                    thumbnail.classList.add('active'); // æ ‡è®°å½“å‰æ˜¾ç¤ºçš„å›¾ç‰‡
                }
                if (image.parentElement.classList.contains('selected')) {
                    thumbnail.classList.add('thumb-selected'); // æ ‡è®°å½“å‰é€‰å®šçš„å›¾ç‰‡
                }

                // æ›´æ–° tools çš„ä½ç½®
                thumbnail.addEventListener('mousemove', function(e) {
                    tools.style.position = 'fixed';
                    tools.style.left = (e.clientX - 80 - 20) + 'px';
                    tools.style.top = (e.clientY - 25 - 10) + 'px';
                });

                // ä¸€ä¸ªå…ƒç´ éœ€è¦æ˜¾ç¤ºæç¤º
                thumbnail.addEventListener('mouseover', function() {
                    let id = image.getAttribute('data-frame');
                    let time = image.getAttribute('data-timestamp');
                    tools.textContent = id + ' - ' + time;
                    tools.style.display = 'block';
                });
                // å…³é—­æç¤º
                thumbnail.addEventListener('mouseout', function() {
                    tools.textContent = '';
                    tools.style.display = 'none';
                });

                thumbnail.addEventListener('click', function(e) {
                    // ç‚¹å‡»ç¼©ç•¥å›¾æ—¶æ›´æ–°å¤§å›¾
                    lightboxImg.src = image.src;
                    frameIdSpan.textContent = image.dataset.frame;
                    timestampSpan.textContent = image.dataset.timestamp;
                    currentImageIndex = index;
                    originalImage = image;
                    updateButtonStatus();
                    boxVision();
                });
                wrapper.appendChild(thumbnail);
                wrapper.appendChild(tipText);
                thumbnailsDiv.appendChild(wrapper);
            });
        }

        // æ›´æ–°ä¸»å›¾
        function updateImage() {
            let image = images[currentImageIndex];
            lightboxImg.src = image.src;
            lightboxImg.dataset.frame = image.dataset.frame;
            lightboxImg.dataset.timestamp = image.dataset.timestamp;
            frameIdSpan.textContent = image.dataset.frame;
            timestampSpan.textContent = image.dataset.timestamp;
            originalImage = image;
            updateButtonStatus();
            boxVision();
        }

        // ç¯ç®±-æ›´æ–°æŒ‰é’®çŠ¶æ€
        function updateButtonStatus() {
            prevButton.disabled = currentImageIndex === 0;
            nextButton.disabled = currentImageIndex === images.length - 1;
            updateThumbnails(); // åœ¨æ›´æ–°æŒ‰é’®çŠ¶æ€æ—¶è°ƒç”¨ç¼©ç•¥å›¾æ›´æ–°å‡½æ•°
        }

        // ç¯ç®±-æ›´æ–°ä¸»å›¾æ ‡è®°æ•ˆæœ
        function boxVision () {
            let boxImage = document.getElementById('lightbox-img');
            if (originalImage.parentElement.classList.contains('selected')) {
                boxImage.classList.add('box-selected');
            } else {
                boxImage.classList.remove('box-selected');
            }
        }

        function prevButtonAction() {
            if (currentImageIndex > 0) {
                currentImageIndex--;
                updateImage();
                scrollToActive();
            }
        }

        function nextButtonAction() {
            if (currentImageIndex < images.length - 1) {
                currentImageIndex++;
                updateImage();
                scrollToActive();
            }
        }

        // ç¯ç®±-ä¸Šä¸€å¼ æ ‡ç­¾
        prevButton.addEventListener('click', function() {
            prevButtonAction();
        });

        // ç¯ç®±-ä¸‹ä¸€å¼ æ ‡ç­¾
        nextButton.addEventListener('click', function() {
            nextButtonAction();
        });

        // ç¯ç®±-å…³é—­æ ‡ç­¾
        closeButton.addEventListener('click', function() {
            closeLightbox();
        });

        // ç¯ç®±-é‡é€‰æ ‡ç­¾
        reselectButton.addEventListener('click', function(e) {
            let imageContainer = document.querySelectorAll('.image-container');
            let container = imageContainer[diffIndex]
            let markButton = container.querySelectorAll('.image-box button');
            markButton.forEach(mark => {
                mark.classList.remove('marked');
                mark.closest('.image-box').classList.remove('selected');
                mark.closest('.image-box').style.display = '';
            });

            boxSideBar('0 -> 0', 'none', '0.00000', 'none');

            let timeDivs = Array.from(document.querySelectorAll('.time-difference'));
            let resContainers = Array.from(document.querySelectorAll('.result-container'));
            let options = Array.from(document.querySelectorAll('.options'));
            timeDivs[diffIndex].textContent = '0.00000';
            timeDivs[diffIndex].classList.remove('effect-on');
            timeDivs[diffIndex].classList.add('effect-off');
            resContainers[diffIndex].style.display = 'none';
            options[diffIndex].style.display = 'none';

            let allThumb = Array.from(document.querySelectorAll('.thumb-selected'));
            allThumb.forEach(thumb => {
                thumb.classList.remove('thumb-selected');
            });

            images = Array.from(container.querySelectorAll('.image-box img'));

            // æ˜¾ç¤ºå…¨éƒ¨ç¼©ç•¥å›¾
            let thumbs = Array.from(document.querySelectorAll('.thumbnail'));
            thumbs.forEach(thumb => {thumb.style.display = ''});
            updateIndex();

            updateThumbnails();
            scrollToActive();
            updateButtonStatus();

            let boxImage = document.getElementById('lightbox-img');
            boxImage.classList.remove('box-selected');
        });

        // ç¯ç®±-ç¼©ç•¥å›¾æ»šåŠ¨æ¡è‡ªåŠ¨è·Ÿéš
        function scrollToActive() {
            let thumbnailsDiv = document.getElementById('thumbnails');
            let thumbnails = thumbnailsDiv.querySelectorAll('.thumbnail');
            let activeThumbnail = thumbnails[currentImageIndex];

            let thumbnailStart = activeThumbnail.offsetLeft;
            let thumbnailEnd = thumbnailStart + activeThumbnail.offsetWidth;

            let viewStart = thumbnailsDiv.scrollLeft;
            let viewEnd = viewStart + thumbnailsDiv.offsetWidth;

            // åˆ¤æ–­å½“å‰å›¾ç‰‡æ˜¯å¦ä¸ºå¯è§†åŒºåŸŸæœ€å·¦ä¾§çš„ç¬¬äºŒå¼ 
            let isSecondVisibleThumbnail = currentImageIndex === 1 && thumbnailStart >= viewStart && thumbnailEnd <= viewEnd;
            // ç¼©ç•¥å›¾ä½äºè§†å›¾ä¹‹å¤–çš„å·¦ä¾§
            if (thumbnailStart < viewStart && !isSecondVisibleThumbnail) {
                // è®©ç¬¬äºŒå¼ å›¾ç‰‡å‡ºç°åœ¨å¯è§†åŒºåŸŸçš„æœ€å·¦ä¾§
                thumbnailsDiv.scrollLeft = thumbnailStart - thumbnails[0].offsetWidth;
            // å¦‚æœç¼©ç•¥å›¾åœ¨å³ä¾§ï¼Œçœ‹ä¸è§
            } else if (thumbnailEnd > viewEnd) {
                thumbnailsDiv.scrollLeft = thumbnailEnd - thumbnailsDiv.offsetWidth;
            }
            // å¦‚æœç¼©ç•¥å›¾å®Œå…¨åœ¨è§†å›¾ä¸­ï¼Œåˆ™ä¸è¿›è¡Œæ»šåŠ¨
        }

        // ç¯ç®±-ä¸»å›¾ç‚¹å‡»äº‹ä»¶
        lightboxImg.addEventListener('click', function(e) {
            timeCost();
        });

        function timeCost() {
            let parentImage = originalImage.parentElement;
            let buttons = Array.from(parentImage.querySelectorAll('button'));
            let thumbActive = document.querySelector('.thumbnail.active');

            if (parentImage.classList.contains('selected')) {
                lightboxImg.classList.remove('box-selected');
                parentImage.classList.remove('selected');
                buttons.forEach(button => button.classList.remove('marked'));
                thumbActive.classList.remove('thumb-selected');

            } else {
                let resImages =  Array.from(parentImage.parentElement.querySelectorAll('.marked'));
                if (resImages.length < 2) {
                    lightboxImg.classList.add('box-selected');
                    parentImage.classList.add('selected');
                    buttons.forEach(button => button.classList.add('marked'));
                    thumbActive.classList.add('thumb-selected');
                } else {
                    showAlert('å·²ç»é€‰æ‹©äº†ä¸¤ä¸ªæ ‡è®°ï¼Œè¯·å…ˆå–æ¶ˆä¸€ä¸ªæ ‡è®°å†è¿›è¡Œæ“ä½œï¼');
                    return;
                }
            }

            let resContainers = Array.from(document.querySelectorAll('.result-container'));
            let timeDivs = Array.from(document.querySelectorAll('.time-difference'));
            let resMark = parentImage.parentElement.querySelectorAll('.marked');
            let allImages = Array.from(imageContainers[diffIndex].querySelectorAll('.image-box img'));
            let options = Array.from(document.querySelectorAll('.options'));

            if (resMark.length === 0) {
                allImages.forEach(image => {image.parentElement.style.display = ''}); // æ˜¾ç¤ºæ‰€æœ‰å›¾ç‰‡
                timeDivs[diffIndex].textContent = '0.00000';
                timeDivs[diffIndex].classList.remove('effect-on');
                timeDivs[diffIndex].classList.add('effect-off');
                resContainers[diffIndex].style.display = 'none';
                options[diffIndex].style.display = 'none';
                
                boxSideBar('0 -> 0', 'none', '0.00000', 'none');

                images = allImages;

                // æ˜¾ç¤ºå…¨éƒ¨ç¼©ç•¥å›¾
                let thumbs = Array.from(document.querySelectorAll('.thumbnail'));
                thumbs.forEach(thumb => {thumb.style.display = ''});
                updateIndex();

                updateThumbnails();
                scrollToActive();
                updateButtonStatus();

            } else if (resMark.length === 1) {
                allImages.forEach(image => {image.parentElement.style.display = ''}); // æ˜¾ç¤ºæ‰€æœ‰å›¾ç‰‡
                timeDivs[diffIndex].textContent = '0.00000';
                timeDivs[diffIndex].classList.remove('effect-on');
                timeDivs[diffIndex].classList.add('effect-off');
                resContainers[diffIndex].style.display = 'none';
                options[diffIndex].style.display = 'none';
                
                let diff1 = resMark[0].closest('.image-box').querySelector('img');
                boxSideBar(diff1.dataset.frame, '', '0.00000', 'none');

                images = allImages;

                // æ˜¾ç¤ºå…¨éƒ¨ç¼©ç•¥å›¾
                let thumbs = Array.from(document.querySelectorAll('.thumbnail'));
                thumbs.forEach(thumb => {thumb.style.display = ''});
                updateIndex();

                updateThumbnails();
                scrollToActive();
                updateButtonStatus();

            } else if (resMark.length === 2) {
                allImages.forEach(image => {
                    image.parentElement.style.display = image.parentElement.classList.contains('selected') ? '' : 'none';
                });
                let frame1 = Number(resMark[0].closest('.image-box').querySelector('img').getAttribute('data-frame'));
                let frame2 = Number(resMark[1].closest('.image-box').querySelector('img').getAttribute('data-frame'));
                let timestamp1 = Number(resMark[0].closest('.image-box').querySelector('img').getAttribute('data-timestamp'));
                let timestamp2 = Number(resMark[1].closest('.image-box').querySelector('img').getAttribute('data-timestamp'));
                let diff = Math.abs(timestamp2 - timestamp1).toFixed(5);
                
                boxSideBar(frame1 + ' -> ' + frame2, '', diff, '');

                timeDivs[diffIndex].textContent = diff;
                timeDivs[diffIndex].classList.add('effect-on');
                timeDivs[diffIndex].classList.remove('effect-off');
                options[diffIndex].style.display = 'flex';
                resContainers[diffIndex].style.display = 'flex';

                // éšè—ç¼©ç•¥å›¾
                images = allImages.filter(img => img.parentElement.style.display === '');
                updateIndex();
                
                updateThumbnails();
                scrollToActive();
                updateButtonStatus();
            }
        }

        // æ‰¾å‡ºå½“å‰ç‚¹å‡»å›¾ç‰‡åœ¨æ–°çš„ images æ•°ç»„ä¸­çš„ç´¢å¼•
        function updateIndex() {
            let originalIndex = originalImage.getAttribute('data-frame');
            for (let i = 0; i < images.length; i++) {
                if (images[i].getAttribute('data-frame') === originalIndex) {
                    currentImageIndex = i;
                }
            }
        }
    </script>

    <!--æç¤ºæ¡†-->
    <script>
        // å¼€å¯è­¦å‘Šæç¤ºæ¡†
        function showAlert(message) {
            document.getElementById('custom-alert').style.display = 'block';
            document.querySelector('.alert-message').innerText = message;
        }

        // å…³é—­è­¦å‘Šæç¤ºæ¡†
        function closeAlert() {
            document.getElementById('custom-alert').style.display = 'none';
        }
        
        // å¤åˆ¶
        async function copyAction(content) {
            try {
                await navigator.clipboard.writeText(content);
                showNotification('âœ… å¤åˆ¶æˆåŠŸï¼');
            } catch (err) {
                console.error('Clipboard API å¤åˆ¶å¤±è´¥:', err);
                showNotification('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', true);
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            
            // æ ¹æ®æ˜¯å¦æ˜¯é”™è¯¯çŠ¶æ€ï¼Œåˆ‡æ¢æ ·å¼
            notification.classList.toggle('error', isError);
            notification.classList.add('show');

            // 2 ç§’åéšè—
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2000);
        }

        // é¡µé¢åŠ è½½äº‹ä»¶
        window.addEventListener('load', function() {
            // é¡µé¢åŠ è½½å®Œæ¯•åç­‰å¾…1ç§’å†å…³é—­ç­‰å¾…åŠ¨ç”»
            setTimeout(function() {
                const loading = document.getElementById('loading');
                loading.style.display = 'none';
            }, 1000);
            // é¡µé¢åŠ è½½å®Œæ¯•åï¼Œå°†æ»šåŠ¨æ¡ç½®äºæœ€å·¦ä¾§
            let containers = document.querySelectorAll('.image-container');
            for (var i = 0; i < containers.length; i++) {
                containers[i].scrollLeft = 0;
            }
        });

        // é¡µé¢åŠ è½½å®Œæ¯•åï¼Œå…ˆè®¡ç®—ç»“æœ
        document.addEventListener("DOMContentLoaded", function() {
            const imageContainers = document.querySelectorAll('.image-container');
            imageContainers.forEach((container, index) => {
                const startFrame = parseInt(container.getAttribute('data-start'));
                const endFrame = parseInt(container.getAttribute('data-end'));
                const startImage = container.querySelector(`img[data-frame="${startFrame}"]`);
                const endImage = container.querySelector(`img[data-frame="${endFrame}"]`);

                if (startImage && endImage) {
                    const startTime = parseFloat(startImage.getAttribute('data-timestamp'));
                    const endTime = parseFloat(endImage.getAttribute('data-timestamp'));

                    const difference = endTime - startTime;
                    const resContainers = Array.from(document.querySelectorAll('.result-container'));
                    const timeDivs = Array.from(document.querySelectorAll('.time-difference'));
                    timeDivs[index].textContent = difference.toFixed(5);
                    timeDivs[index].classList.add('effect-on');
                    resContainers[index].style.display = 'flex';
                } else {
                    const timeDivs = Array.from(document.querySelectorAll('.time-difference'));
                    timeDivs[index].classList.add('effect-off');
                }
            });
        });

        // ç»“æœæ ‡ç­¾ï¼Œç‚¹å‡»åå¤åˆ¶
        var singleCopy = Array.from(document.querySelectorAll('.result-container button'));
        singleCopy.forEach(single => {
            single.addEventListener('click', function(e) {
                let rawContent = single.textContent;
                // å°è¯•å°†å†…å®¹è½¬æ¢ä¸ºæ•°å­—å¹¶ä¿ç•™å°æ•°ç‚¹åäº”ä½
                let numberContent = parseFloat(rawContent);
                if (!isNaN(numberContent)) {
                    rawContent = numberContent.toFixed(5);
                }
                // å»é™¤æ¢è¡Œã€ç©ºç™½ç­‰æ ¼å¼
                let cleanContent = rawContent.trim().replace(/\s+/g, ' ');
                copyAction(cleanContent);
            });
        });

        // å…¨éƒ¨å¤åˆ¶æŒ‰é’®
        var copyButtons = Array.from(document.querySelectorAll('.all-copy'));
        copyButtons.forEach(copy => {
            copy.addEventListener('click', function(e) {
                let timeDivs = Array.from(document.querySelectorAll('.time-difference'));
                let textToCopy = '';
                timeDivs.forEach(res => {
                    if (res.classList.contains('effect-on')) {
                        let rawContent = res.textContent;
                        // å»é™¤ç©ºæ ¼ã€æ¢è¡Œå’Œå…¶ä»–ç©ºç™½å­—ç¬¦
                        rawContent = rawContent.replace(/\s+/g, '');
                        let numberContent = parseFloat(rawContent);
                        if (!isNaN(numberContent)) {
                            rawContent = numberContent.toFixed(5);
                        }
                        textToCopy += rawContent + '\t';
                    }
                });
                copyAction(textToCopy);
            });
        });

        // å…¨éƒ¨é‡é€‰æŒ‰é’®
        var againButtons = Array.from(document.querySelectorAll('.all-reselect'));
        againButtons.forEach((again, index) => {
            again.addEventListener('click', function(e) {
                let resMarked = document.querySelectorAll('.marked');
                resMarked.forEach(marked => {
                    marked.classList.remove('marked');
                })
                let resSelected = document.querySelectorAll('.selected');
                resSelected.forEach(selected => {
                    selected.classList.remove('selected');
                })
                let allImageBox = document.querySelectorAll('.image-container .image-box');
                allImageBox.forEach(imageBox => {
                    imageBox.style.display = '';
                });
                let resContainers = Array.from(document.querySelectorAll('.result-container'));
                resContainers.forEach(res => {
                    res.style.display = 'none'
                });
                let timeDiff = Array.from(document.querySelectorAll('.time-difference'));
                timeDiff.forEach(diff => {
                    diff.textContent = '0.00000';
                    diff.classList.remove('effect-on');
                    diff.classList.add('effect-off');
                });
                let options = Array.from(document.querySelectorAll('.options'));
                options.forEach(option => {
                    option.style.display = 'none';
                });
                boxSideBar('0 -> 0', '0.00000', 'none');
            });
        });

        // é¢å¤–ä¿¡æ¯æ ‡ç­¾
        var extraButtons = Array.from(document.querySelectorAll('.ex-info'));
        extraButtons.forEach((ex, index) => {
            ex.addEventListener('click', function(e) {
                const newWindow = window.open('', '_blank');
                // è·å–å½“å‰ç‚¹å‡»çš„æŒ‰é’®çš„çˆ¶å®¹å™¨
                const parentContainer = e.currentTarget.closest('.image-container');
                // åœ¨çˆ¶å®¹å™¨å†…æ‰¾åˆ° extra å†…å®¹ï¼Œè·å–åŸæœ‰å†…å®¹ï¼Œå¹¶è¿›è¡Œå¤åˆ¶
                const originalContent = parentContainer.querySelector('.extra').cloneNode(true);
                // æ·»åŠ æ ·å¼
                const styles = `
                    <style>
                        .loader-wrapper {
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            z-index: 9999;
                            background-color: rgba(255, 255, 255, 0.9);
                            display: flex;
                            justify-content: center;
                            align-items: center;
                        }
                        .loader {
                            border: 30px solid #f3f3f3;
                            border-top: 30px solid #3498db;
                            border-radius: 50%;
                            width: 200px;
                            height: 200px;
                            animation: spin 1s linear infinite;
                        }
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }

                        .extra-container {
                            display: flex;
                            flex-wrap: wrap;
                            justify-content: space-around;
                            border: 1px solid #ccc;
                            padding: 16px;
                            margin: 16px;
                            border-radius: 8px;
                            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                            transition: all 0.3s ease;
                        }
                        .extra-container:hover {
                            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
                        }
                        .extra-image {
                            max-width: 350px;
                            max-height: 700px;
                            flex-basis: calc(100% / 6 - 20px);
                            margin: 10px;
                            text-align: center;
                        }
                        .img-extra {
                            margin: 20px;
                            max-height: 80%;
                            max-width: 80%;
                        }
                        .img-extra:hover {
                            cursor: zoom-in;
                            box-shadow: 0 0 10px 5px rgb(0 0 0 / 30%);
                            transform: scale(1.03);
                            transition: all 0.3s ease;
                        }
                        .img-extra:active {
                            transform: scale(0.98);
                        }
                        p {
                            margin: 0;
                            font-size: 20px;
                            font-weight: bold;
                            color: #0d96a7;
                        }

                        .zoomed-in {
                            position: fixed;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            z-index: 9999;
                            cursor: zoom-in;
                        }
                        .zoomed-in:hover {
                            cursor: crosshair;
                            box-shadow: 0px 0px 100px rgba(255,192,203,0.5);
                            transition: box-shadow 0.5s ease;
                        }

                        .overlay {
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: rgba(0, 0, 0, 0.3);
                            z-index: 9998;
                            backdrop-filter: blur(30px);
                        }

                        @media screen and (orientation: landscape) {
                            .zoomed-in {
                                max-width: 80%;
                                max-height: 80%;
                            }
                        }
                        @media screen and (orientation: portrait) {
                            .zoomed-in {
                                max-width: 50%;
                                max-height: 50%;
                            }
                        }
                    </style>
                `;

                // åˆ›å»ºä¸€ä¸ªæ–°çš„ <script> å…ƒç´ 
                const scriptElement = newWindow.document.createElement('script');
                // æ·»åŠ JSä»£ç åˆ°æ–°çš„ <script> å…ƒç´ 
                scriptElement.textContent = `
                    document.addEventListener('click', function(e) {
                        if (e.target.classList.contains('img-extra')) {
                            // åˆ›å»ºè¦†ç›–å±‚
                            const overlay = document.createElement('div');
                            overlay.classList.add('overlay');

                            // åˆ›å»ºæ”¾å¤§çš„å›¾ç‰‡
                            const zoomedImage = document.createElement('img');
                            zoomedImage.src = e.target.src;
                            zoomedImage.classList.add('zoomed-in');
                            zoomedImage.style.zIndex = "9999";  // ç¡®ä¿z-indexé«˜äºoverlay

                            // ç‚¹å‡»æ”¾å¤§å›¾ç‰‡æˆ–è¦†ç›–å±‚ç§»é™¤å®ƒä»¬
                            zoomedImage.addEventListener('click', function() {
                                document.body.removeChild(zoomedImage);
                                document.body.removeChild(overlay);
                            });

                            overlay.addEventListener('click', function() {
                                document.body.removeChild(zoomedImage);
                                document.body.removeChild(overlay);
                            });

                            // å°†è¦†ç›–å±‚å’Œæ”¾å¤§çš„å›¾ç‰‡æ·»åŠ åˆ°é¡µé¢
                            document.body.appendChild(overlay);
                            document.body.appendChild(zoomedImage);
                        }
                    });

                    // ç›‘å¬loadäº‹ä»¶æ¥éšè—åŠ è½½åŠ¨ç”»
                    window.addEventListener('load', () => {
                        const loaderWrapper = document.querySelector('.loader-wrapper');
                        if (loaderWrapper) {
                            setTimeout(() => {
                                loaderWrapper.style.opacity = "0";
                                loaderWrapper.style.transition = "opacity 0.3s ease";
                                setTimeout(() => {
                                    loaderWrapper.style.display = "none";
                                }, 500);
                            }, 1000);
                        }
                    });
                `;

                // ä¿®æ”¹å¤åˆ¶å†…å®¹çš„å¯è§æ€§
                originalContent.style.display = 'block';
                // åˆ›å»ºå®Œæ•´çš„HTMLç»“æ„
                var htmlContent = `
                    <html>
                    <head>
                        <title>ç”»å¸§ç§€ - Main - Extra</title>
                        ${styles}
                    </head>
                    <body>
                        ${originalContent.outerHTML}
                    </body>
                    </html>
                `;
                // å°†ä¿®æ”¹åçš„å†…å®¹å†™å…¥æ–°çª—å£
                newWindow.document.write(htmlContent);
                // å°†æ–°çš„ <script> å…ƒç´ æ·»åŠ åˆ°æ–°çª—å£çš„ <body>
                newWindow.document.body.appendChild(scriptElement);
                // åˆ›å»ºåŠ è½½é®ç½©ï¼Œåˆ›å»ºåŠ è½½åŠ¨ç”»
                const loaderWrapper = newWindow.document.createElement('div');
                loaderWrapper.className = 'loader-wrapper';
                const loader = newWindow.document.createElement('div');
                loader.className = 'loader';
                // å°†åŠ è½½åŠ¨ç”»æ·»åŠ åˆ°é®ç½©ä¸­ï¼Œå°†é®ç½©æ·»åŠ åˆ°é¡µé¢çš„bodyä¸­
                loaderWrapper.appendChild(loader);
                newWindow.document.body.appendChild(loaderWrapper);

                newWindow.document.close();
            });

            // ç‚¹å‡»æ”¾å¤§å›¾ç‰‡ï¼Œå†æ¬¡ç‚¹å‡»å¹¶é€€å‡º
            let extraImg = Array.from(document.querySelectorAll('.img-extra'));
            extraImg.forEach((ex, index) => {
                ex.addEventListener('click', function(e) {
                    // åˆ›å»ºä¸€ä¸ªæ–°çš„ img å…ƒç´ å¹¶è®¾ç½®å±æ€§
                    const zoomedImage = document.createElement('img');
                    zoomedImage.src = e.target.src;
                    zoomedImage.classList.add('zoomed-in');
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ä»¥é€€å‡ºæ”¾å¤§æ•ˆæœ
                    zoomedImage.addEventListener('click', function() {
                        document.body.removeChild(zoomedImage);
                    });
                    // å°†æ–°çš„ img å…ƒç´ æ·»åŠ åˆ° body
                    document.body.appendChild(zoomedImage);
                });
            });
        });
    </script>

    <!--ç¯ç®±å†…çš„é”®ç›˜äº‹ä»¶-->
    <script>
        function keyListener(event) {
            switch (event.key) {
                case "ArrowLeft":
                    // å·¦ç®­å¤´é”®è¢«æŒ‰ä¸‹æ—¶æ‰§è¡Œçš„ä»£ç 
                    prevButtonAction();
                    break;
                case "ArrowRight":
                    // å³ç®­å¤´é”®è¢«æŒ‰ä¸‹æ—¶æ‰§è¡Œçš„ä»£ç 
                    nextButtonAction();
                    break;
                case "Enter":
                    // å›è½¦é”®è¢«æŒ‰ä¸‹æ—¶æ‰§è¡Œçš„ä»£ç 
                    timeCost();
                    break;
                case "Escape":
                    // Escapeé”®è¢«æŒ‰ä¸‹æ—¶æ‰§è¡Œçš„ä»£ç 
                    closeLightbox();
                    break;
            }
        }
    </script>

    <!--èƒŒæ™¯åŠ¨ç”»-->
    <script>
        let canvas, ctx, particles, particlePool;

        window.addEventListener('DOMContentLoaded', function() {
            init();
        });

        function init() {
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            particles = [];
            particlePool = [];

            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            window.addEventListener('scroll', resizeCanvas);

            loop();
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.velX = Math.random() * 0.5 - 0.25;
                this.velY = Math.random() * 0.5 - 0.25;
                this.size = Math.random() * 5 + 2;
                this.life = 500;
                this.color = `hsla(${Math.random() * 360}, 100%, 50%, 1)`;
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.shadowBlur = 15;
                ctx.shadowColor = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }

            update() {
                this.x += this.velX;
                this.y += this.velY;
                this.life--;
                if (this.size > 0.2) this.size -= 0.05;
            }
        }

        function createParticle(x, y) {
            const particle = particlePool.pop() || new Particle(x, y);
            particle.x = x;
            particle.y = y;
            particle.life = 500;
            particle.size = Math.random() * 5 + 2;
            particles.push(particle);
        }

        function loop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (Math.random() < 0.3) {
                createParticle(Math.random() * canvas.width, Math.random() * canvas.height);
            }

            particles.forEach((particle, index) => {
                particle.draw();
                particle.update();

                if (particle.life <= 0) {
                    particlePool.push(particles.splice(index, 1)[0]);
                }
            });

            requestAnimationFrame(loop);
        }
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js "></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js "></script>
</body>
</html>